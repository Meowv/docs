(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{773:function(s,a,n){"use strict";n.r(a);var e=n(2),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"创建-swarm-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-swarm-集群"}},[s._v("#")]),s._v(" 创建 Swarm 集群")]),s._v(" "),a("p",[s._v("阅读 "),a("RouterLink",{attrs:{to:"/stack/docker/swarm_mode/overview.html"}},[s._v("基本概念")]),s._v(" 一节我们知道 "),a("code",[s._v("Swarm")]),s._v(" 集群由 "),a("strong",[s._v("管理节点")]),s._v(" 和 "),a("strong",[s._v("工作节点")]),s._v(" 组成。本节我们来创建一个包含一个管理节点和两个工作节点的最小 "),a("code",[s._v("Swarm")]),s._v(" 集群。")],1),s._v(" "),a("h2",{attrs:{id:"初始化集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化集群"}},[s._v("#")]),s._v(" 初始化集群")]),s._v(" "),a("p",[a("code",[s._v("Docker Machine")]),s._v(" 可以在数秒内创建一个虚拟的 Docker 主机，下面我们使用它来创建三个 Docker 主机，并加入到集群中。")]),s._v(" "),a("p",[s._v("我们首先创建一个 Docker 主机作为管理节点。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("docker-machine create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" virtualbox manager\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("我们使用 "),a("code",[s._v("docker swarm init")]),s._v(" 在管理节点初始化一个 "),a("code",[s._v("Swarm")]),s._v(" 集群。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" manager\n\ndocker@manager:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm init --advertise-addr "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.100\nSwarm initialized: current "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dxn1zf6l61qsb1josjja83ngz"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is now a manager.\n\nTo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" a worker to this swarm, run the following command:\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.100:2377\n\nTo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" a manager to this swarm, run "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'docker swarm join-token manager'")]),s._v(" and follow the instructions.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("如果你的 Docker 主机有多个网卡，拥有多个 IP，必须使用 "),a("code",[s._v("--advertise-addr")]),s._v(" 指定 IP。")]),s._v(" "),a("blockquote",[a("p",[s._v("执行 "),a("code",[s._v("docker swarm init")]),s._v(" 命令的节点自动成为管理节点。")])]),s._v(" "),a("h2",{attrs:{id:"增加工作节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#增加工作节点"}},[s._v("#")]),s._v(" 增加工作节点")]),s._v(" "),a("p",[s._v("上一步我们初始化了一个 "),a("code",[s._v("Swarm")]),s._v(" 集群，拥有了一个管理节点，下面我们继续创建两个 Docker 主机作为工作节点，并加入到集群中。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker-machine create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" virtualbox worker1\n\n$ docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" worker1\n\ndocker@worker1:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.100:2377\n\nThis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" joined a swarm as a worker.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker-machine create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" virtualbox worker2\n\n$ docker-machine "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" worker2\n\ndocker@worker1:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" SWMTKN-1-49nj1cmql0jkz5s954yi3oex3nedyz0fb0xx14ie39trti4wxv-8vxv8rssmk743ojnwacrr2e7c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.100:2377\n\nThis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" joined a swarm as a worker.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("注意：一些细心的读者可能通过 "),a("code",[s._v("docker-machine create --help")]),s._v(" 查看到 "),a("code",[s._v("--swarm*")]),s._v(" 等一系列参数。该参数是用于旧的 "),a("code",[s._v("Docker Swarm")]),s._v("，与本章所讲的 "),a("code",[s._v("Swarm mode")]),s._v(" 没有关系。")])]),s._v(" "),a("h2",{attrs:{id:"查看集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看集群"}},[s._v("#")]),s._v(" 查看集群")]),s._v(" "),a("p",[s._v("经过上边的两步，我们已经拥有了一个最小的 "),a("code",[s._v("Swarm")]),s._v(" 集群，包含一个管理节点和两个工作节点。")]),s._v(" "),a("p",[s._v("在管理节点使用 "),a("code",[s._v("docker node ls")]),s._v(" 查看集群。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nID                           "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")]),s._v("  STATUS  AVAILABILITY  MANAGER STATUS\n03g1y59jwfg7cf99w4lt0f662    worker2   Ready   Active\n9j68exjopxe7wfl6yuxml7a7j    worker1   Ready   Active\ndxn1zf6l61qsb1josjja83ngz *  manager   Ready   Active        Leader\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);