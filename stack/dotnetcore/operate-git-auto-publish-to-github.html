<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Core 下操作 Git，自动提交代码到 GitHub | 📖Documents</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="This is a personal document library for development work">
    <link rel="preload" href="/assets/css/0.styles.7cd537df.css" as="style"><link rel="preload" href="/assets/js/app.e48e65e6.js" as="script"><link rel="preload" href="/assets/js/2.e3caa61b.js" as="script"><link rel="preload" href="/assets/js/62.5743ea43.js" as="script"><link rel="prefetch" href="/assets/js/10.59e185dc.js"><link rel="prefetch" href="/assets/js/11.28c9dbfa.js"><link rel="prefetch" href="/assets/js/12.3c5d5553.js"><link rel="prefetch" href="/assets/js/13.70769735.js"><link rel="prefetch" href="/assets/js/14.60ab21a1.js"><link rel="prefetch" href="/assets/js/15.e24be883.js"><link rel="prefetch" href="/assets/js/16.5a059047.js"><link rel="prefetch" href="/assets/js/17.de4804ab.js"><link rel="prefetch" href="/assets/js/18.e30e4fa1.js"><link rel="prefetch" href="/assets/js/19.3b2995db.js"><link rel="prefetch" href="/assets/js/20.c0b8de95.js"><link rel="prefetch" href="/assets/js/21.7fcfde60.js"><link rel="prefetch" href="/assets/js/22.d529874d.js"><link rel="prefetch" href="/assets/js/23.41ae11ad.js"><link rel="prefetch" href="/assets/js/24.3c08932e.js"><link rel="prefetch" href="/assets/js/25.53a6dbd3.js"><link rel="prefetch" href="/assets/js/26.e7d79d01.js"><link rel="prefetch" href="/assets/js/27.6777c255.js"><link rel="prefetch" href="/assets/js/28.fcfbc89b.js"><link rel="prefetch" href="/assets/js/29.f5fa0de9.js"><link rel="prefetch" href="/assets/js/3.b09601c6.js"><link rel="prefetch" href="/assets/js/30.473e9703.js"><link rel="prefetch" href="/assets/js/31.ce9f1d8e.js"><link rel="prefetch" href="/assets/js/32.0dd13b46.js"><link rel="prefetch" href="/assets/js/33.9c7079a2.js"><link rel="prefetch" href="/assets/js/34.60d625ee.js"><link rel="prefetch" href="/assets/js/35.34c946db.js"><link rel="prefetch" href="/assets/js/36.5c7fcc59.js"><link rel="prefetch" href="/assets/js/37.b177ef54.js"><link rel="prefetch" href="/assets/js/38.fb133f77.js"><link rel="prefetch" href="/assets/js/39.f1dcd20f.js"><link rel="prefetch" href="/assets/js/4.1624411d.js"><link rel="prefetch" href="/assets/js/40.7cae12cd.js"><link rel="prefetch" href="/assets/js/41.7f843fdc.js"><link rel="prefetch" href="/assets/js/42.1e891ee2.js"><link rel="prefetch" href="/assets/js/43.c1f82ce1.js"><link rel="prefetch" href="/assets/js/44.3ab74dfc.js"><link rel="prefetch" href="/assets/js/45.05ca04f9.js"><link rel="prefetch" href="/assets/js/46.f0e1e5be.js"><link rel="prefetch" href="/assets/js/47.db23e5fa.js"><link rel="prefetch" href="/assets/js/48.f008a2f1.js"><link rel="prefetch" href="/assets/js/49.1e0e273d.js"><link rel="prefetch" href="/assets/js/5.a1bf63ab.js"><link rel="prefetch" href="/assets/js/50.08507882.js"><link rel="prefetch" href="/assets/js/51.cb825d94.js"><link rel="prefetch" href="/assets/js/52.cc387276.js"><link rel="prefetch" href="/assets/js/53.2a9da021.js"><link rel="prefetch" href="/assets/js/54.2b0dd1f1.js"><link rel="prefetch" href="/assets/js/55.89a2f46d.js"><link rel="prefetch" href="/assets/js/56.913c7f9c.js"><link rel="prefetch" href="/assets/js/57.bdfbb16d.js"><link rel="prefetch" href="/assets/js/58.80e79f5e.js"><link rel="prefetch" href="/assets/js/59.ae5fe90d.js"><link rel="prefetch" href="/assets/js/6.756e00a9.js"><link rel="prefetch" href="/assets/js/60.cc85e9bb.js"><link rel="prefetch" href="/assets/js/61.94c06fcb.js"><link rel="prefetch" href="/assets/js/63.2b359d8a.js"><link rel="prefetch" href="/assets/js/64.7580ea1b.js"><link rel="prefetch" href="/assets/js/65.4a5ef7bc.js"><link rel="prefetch" href="/assets/js/66.7e346916.js"><link rel="prefetch" href="/assets/js/67.5857460f.js"><link rel="prefetch" href="/assets/js/68.23537f0b.js"><link rel="prefetch" href="/assets/js/69.6f66a0d3.js"><link rel="prefetch" href="/assets/js/7.cf639803.js"><link rel="prefetch" href="/assets/js/70.3aac5d1c.js"><link rel="prefetch" href="/assets/js/71.c4d73678.js"><link rel="prefetch" href="/assets/js/72.410c38ab.js"><link rel="prefetch" href="/assets/js/73.a28b948a.js"><link rel="prefetch" href="/assets/js/74.4acf982e.js"><link rel="prefetch" href="/assets/js/75.9cb31918.js"><link rel="prefetch" href="/assets/js/76.510f6857.js"><link rel="prefetch" href="/assets/js/77.c13c82d9.js"><link rel="prefetch" href="/assets/js/78.cf9f8c00.js"><link rel="prefetch" href="/assets/js/79.f764767d.js"><link rel="prefetch" href="/assets/js/8.803263f8.js"><link rel="prefetch" href="/assets/js/80.cd96e7f7.js"><link rel="prefetch" href="/assets/js/81.304d7038.js"><link rel="prefetch" href="/assets/js/82.de539799.js"><link rel="prefetch" href="/assets/js/83.de71a40f.js"><link rel="prefetch" href="/assets/js/84.0787261d.js"><link rel="prefetch" href="/assets/js/85.1dc87ade.js"><link rel="prefetch" href="/assets/js/86.9500b044.js"><link rel="prefetch" href="/assets/js/87.77e51a14.js"><link rel="prefetch" href="/assets/js/88.aea84947.js"><link rel="prefetch" href="/assets/js/89.1271ad71.js"><link rel="prefetch" href="/assets/js/9.fbbfcec9.js"><link rel="prefetch" href="/assets/js/90.23bd1d82.js"><link rel="prefetch" href="/assets/js/91.c169863e.js"><link rel="prefetch" href="/assets/js/92.6d1e8db9.js"><link rel="prefetch" href="/assets/js/93.36abe7ee.js"><link rel="prefetch" href="/assets/js/94.281517dc.js"><link rel="prefetch" href="/assets/js/95.5de5eb4b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7cd537df.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">📖Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚡系列文章" class="dropdown-title"><span class="title">⚡系列文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  🚀基于 abp vNext 和 .NET Core 开发博客项目
</a></li></ul></div></div><div class="nav-item"><a href="/python/" class="nav-link">
  🎈Python
</a></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  🍺技术栈
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  🎉总结
</a></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    ⭐️GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⚡系列文章" class="dropdown-title"><span class="title">⚡系列文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  🚀基于 abp vNext 和 .NET Core 开发博客项目
</a></li></ul></div></div><div class="nav-item"><a href="/python/" class="nav-link">
  🎈Python
</a></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  🍺技术栈
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  🎉总结
</a></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    ⭐️GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>.NET Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/stack/dotnetcore/mta-package.html" class="sidebar-link">使用MTA HTML5统计API来分析数据</a></li><li><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html" aria-current="page" class="active sidebar-link">.NET Core 下操作 Git，自动提交代码到 GitHub</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html#安装项目模板" class="sidebar-link">安装项目模板</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html#创建项目" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html#libgit2sharp-简单使用" class="sidebar-link">LibGit2Sharp 简单使用</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html#自动-push-代码盖大楼" class="sidebar-link">自动 Push 代码盖大楼</a></li></ul></li><li><a href="/stack/dotnetcore/epplus-wps-error.html" class="sidebar-link">EPPlus.Core 处理 Excel 报错之天坑 WPS</a></li><li><a href="/stack/dotnetcore/publish-to-centos.html" class="sidebar-link">基于.NET Core开发的个人博客 发布至CentOS小计</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blazor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Message Queue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Grafana</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Zabbix</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="net-core-下操作-git，自动提交代码到-github"><a href="#net-core-下操作-git，自动提交代码到-github" class="header-anchor">#</a> .NET Core 下操作 Git，自动提交代码到 GitHub</h1> <p>.NET Core 3.0 预览版发布已经好些时日了，博客园也已将其用于生产环境中，可见 .NET Core 日趋成熟，你想盖大楼吗？想 GitHub 首页一片绿吗？今天拿她玩玩自动化提交代码至 GitHub。</p> <h2 id="安装项目模板"><a href="#安装项目模板" class="header-anchor">#</a> 安装项目模板</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>dotnet new --install <span class="token string">&quot;Microsoft.DotNet.Web.ProjectTemplates.3.0&quot;</span>
dotnet new worker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h2> <p>直接使用 .NET CLI 创建一个 Work Service 的项目</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>dotnet new worker -o AutomaticPush
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>用 Visual Studio 2019 打开项目可以看到以下代码</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Program.cs</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hostContext<span class="token punctuation">,</span> services<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddHostedService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Worker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>从 3.0 起 WebHost 被 Host 取代了</li> <li><code>CreateHostBuilder</code>创建 Host 并在<code>ConfigureServices</code>中调用<code>.AddHostedService&lt;Worker&gt;()</code></li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Worker.cs</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BackgroundService</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>Worker<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Worker</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>Worker<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">ExecuteAsync</span><span class="token punctuation">(</span><span class="token class-name">CancellationToken</span> stoppingToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stoppingToken<span class="token punctuation">.</span>IsCancellationRequested<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _logger<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;Worker running at: {time}&quot;</span><span class="token punctuation">,</span> DateTimeOffset<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> stoppingToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Worker 继承了 BackgroundService，在 override ExecuteAsync 方法中完成自动提交的代码</p> <p>.NET 下操作 Git 需要用到一个库 <code>LibGit2Sharp</code>，同时支持 .NET Framework 及 .NET Core</p> <p>在项目中安装使用</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Install-Package LibGit2Sharp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="libgit2sharp-简单使用"><a href="#libgit2sharp-简单使用" class="header-anchor">#</a> LibGit2Sharp 简单使用</h2> <ul><li><p><code>Repository.Init(@&quot;D:\Work&quot;)</code> 在指定路径创建一个新的 Git 仓库，相当于 <code>git init</code></p></li> <li><p><code>Repository.Clone(&quot;https://github.com/Meowv/Blog.git&quot;, @&quot;D:\Work&quot;)</code> 拉取一个远程仓库到本地，相当于 <code>git clone</code></p></li> <li><p><code>using (var repo = new Repository(@&quot;D:\Blog&quot;)){}</code> 打开本地存在的 Git 仓库</p></li> <li><p>获取 Branch</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Repository</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\Blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> branches <span class="token operator">=</span> repo<span class="token punctuation">.</span>Branches<span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> branches<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>获取 Commits</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Repository</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\Blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> commit <span class="token keyword">in</span> repo<span class="token punctuation">.</span>Commits<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>获取 Tags</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Repository</span><span class="token punctuation">(</span><span class="token string">@&quot;D:\Blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> commit <span class="token keyword">in</span> repo<span class="token punctuation">.</span>Tags<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>更多操作请移步 <a href="https://github.com/libgit2/libgit2sharp" target="_blank" rel="noopener noreferrer">https://github.com/libgit2/libgit2sharp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="自动-push-代码盖大楼"><a href="#自动-push-代码盖大楼" class="header-anchor">#</a> 自动 Push 代码盖大楼</h2> <p>有了以上基础，就可以实现自动生成文件，push 代码到 GitHub 了。</p> <p>新建一个配置文件，存放我们 GitHub 仓库以及账号密码等重要信息</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;本地git仓库绝对路径&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GitHub账号&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GitHub密码&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;提交人&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;邮箱&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在ExecuteAsync中读取配置文件信息</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> configurationRoot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConfigurationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddJsonFile</span><span class="token punctuation">(</span><span class="token string">&quot;config.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> path <span class="token operator">=</span> configurationRoot<span class="token punctuation">[</span><span class="token string">&quot;repository&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> username <span class="token operator">=</span> configurationRoot<span class="token punctuation">[</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> password <span class="token operator">=</span> configurationRoot<span class="token punctuation">[</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> name <span class="token operator">=</span> configurationRoot<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> email <span class="token operator">=</span> configurationRoot<span class="token punctuation">[</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>git会自动检测文件变化，所以就先自动按日期创建.log文件，不断生成内容然后提交</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>stoppingToken<span class="token punctuation">.</span>IsCancellationRequested<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> fileName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">&quot;dd&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.log&quot;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 写入内容</span>
    <span class="token function">WriteText</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Repository</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Stage the file</span>
        Commands<span class="token punctuation">.</span><span class="token function">Stage</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create the committer's signature and commit</span>
        <span class="token class-name"><span class="token keyword">var</span></span> author <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Signature</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> committer <span class="token operator">=</span> author<span class="token punctuation">;</span>
        <span class="token comment">// Commit to the repository</span>
        <span class="token class-name"><span class="token keyword">var</span></span> commit <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> author<span class="token punctuation">,</span> committer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// git push</span>
        <span class="token class-name"><span class="token keyword">var</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PushOptions</span>
        <span class="token punctuation">{</span>
            CredentialsProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CredentialsHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> usernameFromUrl<span class="token punctuation">,</span> types<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UsernamePasswordCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    Username <span class="token operator">=</span> username<span class="token punctuation">,</span>
                    Password <span class="token operator">=</span> password
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        repo<span class="token punctuation">.</span>Network<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span>repo<span class="token punctuation">.</span>Branches<span class="token punctuation">[</span><span class="token string">&quot;master&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 等待60秒继续执行...</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">60000</span><span class="token punctuation">,</span> stoppingToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">WriteText</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> content<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    path <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">@&quot;yyyy\\MM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name"><span class="token keyword">var</span></span> filePath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Append<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>至此，整个代码编写部分结束，项目发布后可以选择sc.exe注册为Windows服务，在这里推荐使用nssm(一个服务封装程序)，好了，赶紧盖大楼去吧~~</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/meowv/docs/edit/master//stack/dotnetcore/operate-git-auto-publish-to-github.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">13 hours ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/stack/dotnetcore/mta-package.html" class="prev">
        使用MTA HTML5统计API来分析数据
      </a></span> <span class="next"><a href="/stack/dotnetcore/epplus-wps-error.html">
        EPPlus.Core 处理 Excel 报错之天坑 WPS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.e48e65e6.js" defer></script><script src="/assets/js/2.e3caa61b.js" defer></script><script src="/assets/js/62.5743ea43.js" defer></script>
  </body>
</html>
