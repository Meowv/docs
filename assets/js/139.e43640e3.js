(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{811:function(a,e,s){"use strict";s.r(e);var t=s(12),n=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"其它制作镜像的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其它制作镜像的方式"}},[a._v("#")]),a._v(" 其它制作镜像的方式")]),a._v(" "),s("p",[a._v("除了标准的使用 "),s("code",[a._v("Dockerfile")]),a._v(" 生成镜像的方法外，由于各种特殊需求和历史原因，还提供了一些其它方法用以生成镜像。")]),a._v(" "),s("h2",{attrs:{id:"从-rootfs-压缩包导入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从-rootfs-压缩包导入"}},[a._v("#")]),a._v(" 从 rootfs 压缩包导入")]),a._v(" "),s("p",[a._v("格式："),s("code",[a._v("docker import [选项] <文件>|<URL>|- [<仓库名>[:<标签>]]")])]),a._v(" "),s("p",[a._v("压缩包可以是本地文件、远程 Web 文件，甚至是从标准输入中得到。压缩包将会在镜像 "),s("code",[a._v("/")]),a._v(" 目录展开，并直接作为镜像第一层提交。")]),a._v(" "),s("p",[a._v("比如我们想要创建一个 "),s("a",{attrs:{href:"https://openvz.org",target:"_blank",rel:"noopener noreferrer"}},[a._v("OpenVZ"),s("OutboundLink")],1),a._v(" 的 Ubuntu 16.04 "),s("a",{attrs:{href:"https://wiki.openvz.org/Download/template/precreated",target:"_blank",rel:"noopener noreferrer"}},[a._v("模板"),s("OutboundLink")],1),a._v("的镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    openvz/ubuntu:16.04\n\nDownloading from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\nsha256:412b8fc3e3f786dca0197834a698932b9c51b69bd8cf49e100c35d38c9879213\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("这条命令自动下载了 "),s("code",[a._v("ubuntu-16.04-x86_64.tar.gz")]),a._v(" 文件，并且作为根文件系统展开导入，并保存为镜像 "),s("code",[a._v("openvz/ubuntu:16.04")]),a._v("。")]),a._v(" "),s("p",[a._v("导入成功后，我们可以用 "),s("code",[a._v("docker image ls")]),a._v(" 看到这个导入的镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" openvz/ubuntu\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nopenvz/ubuntu       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16.04")]),a._v("               412b8fc3e3f7        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("55")]),a._v(" seconds ago      505MB\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("如果我们查看其历史的话，会看到描述中有导入的文件链接：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("history")]),a._v(" openvz/ubuntu:16.04\nIMAGE               CREATED              CREATED BY          SIZE                COMMENT\nf477a6e18e98        About a minute ago                       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("214.9")]),a._v(" MB            Imported from http://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h2",{attrs:{id:"docker-镜像的导入和导出-docker-save-和-docker-load"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像的导入和导出-docker-save-和-docker-load"}},[a._v("#")]),a._v(" Docker 镜像的导入和导出 "),s("code",[a._v("docker save")]),a._v(" 和 "),s("code",[a._v("docker load")])]),a._v(" "),s("p",[a._v("Docker 还提供了 "),s("code",[a._v("docker save")]),a._v(" 和 "),s("code",[a._v("docker load")]),a._v(" 命令，用以将镜像保存为一个文件，然后传输到另一个位置上，再加载进来。这是在没有 Docker Registry 时的做法，现在已经不推荐，镜像迁移应该直接使用 Docker Registry，无论是直接使用 Docker Hub 还是使用内网私有 Registry 都可以。")]),a._v(" "),s("h3",{attrs:{id:"保存镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#保存镜像"}},[a._v("#")]),a._v(" 保存镜像")]),a._v(" "),s("p",[a._v("使用 "),s("code",[a._v("docker save")]),a._v(" 命令可以将镜像保存为归档文件。")]),a._v(" "),s("p",[a._v("比如我们希望保存这个 "),s("code",[a._v("alpine")]),a._v(" 镜像。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.803")]),a._v(" MB\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("保存镜像的命令为：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker save alpine -o filename\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v(" filename\nfilename: POSIX "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" archive\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("这里的 filename 可以为任意名称甚至任意后缀名，但文件的本质都是归档文件")]),a._v(" "),s("blockquote",[s("p",[a._v("注意：如果同名则会覆盖（没有警告）")])]),a._v(" "),s("p",[a._v("若使用 "),s("code",[a._v("gzip")]),a._v(" 压缩：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker save alpine "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" alpine-latest.tar.gz\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后我们将 "),s("code",[a._v("alpine-latest.tar.gz")]),a._v(" 文件复制到了到了另一个机器上，可以用下面这个命令加载镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker load -i alpine-latest.tar.gz\nLoaded image: alpine:latest\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("如果我们结合这两个命令以及 "),s("code",[a._v("ssh")]),a._v(" 甚至 "),s("code",[a._v("pv")]),a._v(" 的话，利用 Linux 强大的管道，我们可以写一个命令完成从一个机器将镜像迁移到另一个机器，并且带进度条的功能：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker save "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("镜像名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bzip2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pv")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("用户名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("@"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("主机名"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'cat | docker load'")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);