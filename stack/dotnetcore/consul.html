<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Core ä½¿ç”¨ Consul æœåŠ¡æ³¨å†Œå‘ç° | ğŸ“–Documents</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script>var _mtac = {"senseQuery":1};(function() { var mta = document.createElement("script");mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";mta.setAttribute("name", "MTAH5");mta.setAttribute("sid", "500727760");mta.setAttribute("cid", "500727761");var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(mta, s); })();</script>
    <script src="/live2d/L2Dwidget.min.js"></script>
    <script>
        const models = [
            '/live2d/live2d-widget-model-epsilon2_1/assets/Epsilon2.1.model.json',
            '/live2d/live2d-widget-model-haru/01/assets/haru01.model.json',
            '/live2d/live2d-widget-model-haru/02/assets/haru02.model.json',
            '/live2d/live2d-widget-model-haruto/assets/haruto.model.json',
            '/live2d/live2d-widget-model-koharu/assets/koharu.model.json',
            '/live2d/live2d-widget-model-hijiki/assets/hijiki.model.json',
            '/live2d/live2d-widget-model-tororo/assets/tororo.model.json',
            '/live2d/live2d-widget-model-izumi/assets/izumi.model.json',
            '/live2d/live2d-widget-model-miku/assets/miku.model.json',
            '/live2d/live2d-widget-model-shizuku/assets/shizuku.model.json',
            '/live2d/live2d-widget-model-wanko/assets/wanko.model.json',
            '/live2d/live2d-widget-model-z16/assets/z16.model.json'
        ];
        L2Dwidget.init({
            "model": {
                jsonPath: models[parseInt(Math.random() * (models.length))]
            },
            "display": {
                "position": "left",
                "width": 150,
                "height": 210,
                "hOffset": 5,
                "vOffset": 5,
                "superSample": 1,
            },
            "mobile": {
                "scale": 1,
                "show": true,
                "motion": true,
            },
            "react": {
                "opacityDefault": .5,
                "opacityOnHover": .2
            }
        });
    </script>
    <meta name="description" content="This is a personal document library for development work">
    
    <link rel="preload" href="/assets/css/0.styles.74392c83.css" as="style"><link rel="preload" href="/assets/js/app.e42d6934.js" as="script"><link rel="preload" href="/assets/js/2.887f4612.js" as="script"><link rel="preload" href="/assets/js/6.35ad950b.js" as="script"><link rel="prefetch" href="/assets/js/10.9d129c57.js"><link rel="prefetch" href="/assets/js/100.0214024c.js"><link rel="prefetch" href="/assets/js/101.75bd76dc.js"><link rel="prefetch" href="/assets/js/102.2c376caa.js"><link rel="prefetch" href="/assets/js/103.efdb3398.js"><link rel="prefetch" href="/assets/js/104.796fa62d.js"><link rel="prefetch" href="/assets/js/105.8c76330c.js"><link rel="prefetch" href="/assets/js/106.5be1968a.js"><link rel="prefetch" href="/assets/js/107.4bfa6bf6.js"><link rel="prefetch" href="/assets/js/108.f138f5a1.js"><link rel="prefetch" href="/assets/js/109.7ae00b21.js"><link rel="prefetch" href="/assets/js/11.6bf74099.js"><link rel="prefetch" href="/assets/js/110.811757cf.js"><link rel="prefetch" href="/assets/js/111.08273f66.js"><link rel="prefetch" href="/assets/js/112.6689d146.js"><link rel="prefetch" href="/assets/js/113.cf53df91.js"><link rel="prefetch" href="/assets/js/114.03bcf0cf.js"><link rel="prefetch" href="/assets/js/115.ebd76fc6.js"><link rel="prefetch" href="/assets/js/116.dffcb2a1.js"><link rel="prefetch" href="/assets/js/117.196d2728.js"><link rel="prefetch" href="/assets/js/118.12081a8c.js"><link rel="prefetch" href="/assets/js/119.3c8f9081.js"><link rel="prefetch" href="/assets/js/12.49b541ed.js"><link rel="prefetch" href="/assets/js/120.c01d347a.js"><link rel="prefetch" href="/assets/js/121.079eade0.js"><link rel="prefetch" href="/assets/js/122.1cfd012d.js"><link rel="prefetch" href="/assets/js/123.375760da.js"><link rel="prefetch" href="/assets/js/124.408bb92e.js"><link rel="prefetch" href="/assets/js/125.b6857052.js"><link rel="prefetch" href="/assets/js/126.edcee02c.js"><link rel="prefetch" href="/assets/js/127.f22b21b4.js"><link rel="prefetch" href="/assets/js/128.230afb73.js"><link rel="prefetch" href="/assets/js/129.67213f02.js"><link rel="prefetch" href="/assets/js/13.ab823466.js"><link rel="prefetch" href="/assets/js/130.c0b032aa.js"><link rel="prefetch" href="/assets/js/131.c3b7be4b.js"><link rel="prefetch" href="/assets/js/132.9abfa51c.js"><link rel="prefetch" href="/assets/js/133.6f89e55b.js"><link rel="prefetch" href="/assets/js/134.cbeb7ed8.js"><link rel="prefetch" href="/assets/js/135.12cbdd0b.js"><link rel="prefetch" href="/assets/js/136.a1814b87.js"><link rel="prefetch" href="/assets/js/137.c5a13fad.js"><link rel="prefetch" href="/assets/js/138.dc1f5a5d.js"><link rel="prefetch" href="/assets/js/139.ea4ae533.js"><link rel="prefetch" href="/assets/js/14.ee4732e9.js"><link rel="prefetch" href="/assets/js/140.ab962a63.js"><link rel="prefetch" href="/assets/js/141.41766a82.js"><link rel="prefetch" href="/assets/js/142.7adda441.js"><link rel="prefetch" href="/assets/js/143.5e8de722.js"><link rel="prefetch" href="/assets/js/144.33ae4014.js"><link rel="prefetch" href="/assets/js/145.474cc26e.js"><link rel="prefetch" href="/assets/js/146.c35ff3b0.js"><link rel="prefetch" href="/assets/js/147.d489a7d1.js"><link rel="prefetch" href="/assets/js/148.3f6c61a4.js"><link rel="prefetch" href="/assets/js/149.d0d33af2.js"><link rel="prefetch" href="/assets/js/15.0726c4f5.js"><link rel="prefetch" href="/assets/js/150.d6eede24.js"><link rel="prefetch" href="/assets/js/151.bac458d5.js"><link rel="prefetch" href="/assets/js/152.cc5877b1.js"><link rel="prefetch" href="/assets/js/153.d25f9597.js"><link rel="prefetch" href="/assets/js/154.98b55de5.js"><link rel="prefetch" href="/assets/js/155.5845a8c7.js"><link rel="prefetch" href="/assets/js/156.6bad30ea.js"><link rel="prefetch" href="/assets/js/157.4bcffaf6.js"><link rel="prefetch" href="/assets/js/158.ea8f7145.js"><link rel="prefetch" href="/assets/js/159.a81be4eb.js"><link rel="prefetch" href="/assets/js/16.d16b9a59.js"><link rel="prefetch" href="/assets/js/160.a6a872be.js"><link rel="prefetch" href="/assets/js/161.233f7ab7.js"><link rel="prefetch" href="/assets/js/162.32c04418.js"><link rel="prefetch" href="/assets/js/163.32c772d5.js"><link rel="prefetch" href="/assets/js/164.f72d61ef.js"><link rel="prefetch" href="/assets/js/165.bae81bbc.js"><link rel="prefetch" href="/assets/js/166.9cd5bd44.js"><link rel="prefetch" href="/assets/js/167.f4f1e28a.js"><link rel="prefetch" href="/assets/js/168.4ff80510.js"><link rel="prefetch" href="/assets/js/169.9ab9df3d.js"><link rel="prefetch" href="/assets/js/17.7b89a89f.js"><link rel="prefetch" href="/assets/js/170.d3504dfb.js"><link rel="prefetch" href="/assets/js/171.12ff7a39.js"><link rel="prefetch" href="/assets/js/172.268194db.js"><link rel="prefetch" href="/assets/js/173.5a473576.js"><link rel="prefetch" href="/assets/js/174.eb212de5.js"><link rel="prefetch" href="/assets/js/175.13ce776e.js"><link rel="prefetch" href="/assets/js/176.9b034779.js"><link rel="prefetch" href="/assets/js/177.733c0dd5.js"><link rel="prefetch" href="/assets/js/178.cf9b16a6.js"><link rel="prefetch" href="/assets/js/179.c6691f19.js"><link rel="prefetch" href="/assets/js/18.6c9692d4.js"><link rel="prefetch" href="/assets/js/180.69763192.js"><link rel="prefetch" href="/assets/js/181.ed5972a8.js"><link rel="prefetch" href="/assets/js/182.c5365279.js"><link rel="prefetch" href="/assets/js/183.9118401b.js"><link rel="prefetch" href="/assets/js/184.dd597d04.js"><link rel="prefetch" href="/assets/js/185.dcaee5c8.js"><link rel="prefetch" href="/assets/js/186.2f65c143.js"><link rel="prefetch" href="/assets/js/187.489ee437.js"><link rel="prefetch" href="/assets/js/188.1fe871c8.js"><link rel="prefetch" href="/assets/js/189.3d842901.js"><link rel="prefetch" href="/assets/js/19.14b7d450.js"><link rel="prefetch" href="/assets/js/190.fdaaa036.js"><link rel="prefetch" href="/assets/js/191.e18cac78.js"><link rel="prefetch" href="/assets/js/192.414af0da.js"><link rel="prefetch" href="/assets/js/193.e6be0fcf.js"><link rel="prefetch" href="/assets/js/194.b2566812.js"><link rel="prefetch" href="/assets/js/195.00bfbb36.js"><link rel="prefetch" href="/assets/js/196.5851b8e0.js"><link rel="prefetch" href="/assets/js/197.893ae708.js"><link rel="prefetch" href="/assets/js/198.247a4c83.js"><link rel="prefetch" href="/assets/js/199.ad2ea7fd.js"><link rel="prefetch" href="/assets/js/20.79ab36ad.js"><link rel="prefetch" href="/assets/js/200.98c9c7ac.js"><link rel="prefetch" href="/assets/js/201.9ada4425.js"><link rel="prefetch" href="/assets/js/202.795416fa.js"><link rel="prefetch" href="/assets/js/203.d3d54f61.js"><link rel="prefetch" href="/assets/js/204.a49392a2.js"><link rel="prefetch" href="/assets/js/205.f30a99e2.js"><link rel="prefetch" href="/assets/js/206.f6747956.js"><link rel="prefetch" href="/assets/js/207.3ae926e3.js"><link rel="prefetch" href="/assets/js/208.3c101b23.js"><link rel="prefetch" href="/assets/js/209.e362f0db.js"><link rel="prefetch" href="/assets/js/21.d198d3cd.js"><link rel="prefetch" href="/assets/js/210.8110fe55.js"><link rel="prefetch" href="/assets/js/211.22693b13.js"><link rel="prefetch" href="/assets/js/212.7c68d019.js"><link rel="prefetch" href="/assets/js/213.fdec3193.js"><link rel="prefetch" href="/assets/js/214.96a5e12a.js"><link rel="prefetch" href="/assets/js/215.8993c4e7.js"><link rel="prefetch" href="/assets/js/216.933ab147.js"><link rel="prefetch" href="/assets/js/217.669c7216.js"><link rel="prefetch" href="/assets/js/218.8657de53.js"><link rel="prefetch" href="/assets/js/219.f8ac5a8c.js"><link rel="prefetch" href="/assets/js/22.7f60def6.js"><link rel="prefetch" href="/assets/js/220.e05c86a9.js"><link rel="prefetch" href="/assets/js/221.c446f79b.js"><link rel="prefetch" href="/assets/js/222.69891305.js"><link rel="prefetch" href="/assets/js/223.658dcd80.js"><link rel="prefetch" href="/assets/js/224.41017e28.js"><link rel="prefetch" href="/assets/js/225.354e6ab1.js"><link rel="prefetch" href="/assets/js/226.c4bc76bc.js"><link rel="prefetch" href="/assets/js/227.53abefbd.js"><link rel="prefetch" href="/assets/js/228.bd781e86.js"><link rel="prefetch" href="/assets/js/229.a440b4b7.js"><link rel="prefetch" href="/assets/js/23.bd7064bd.js"><link rel="prefetch" href="/assets/js/230.1743c76f.js"><link rel="prefetch" href="/assets/js/231.6f427e46.js"><link rel="prefetch" href="/assets/js/232.b44d6929.js"><link rel="prefetch" href="/assets/js/233.a4ea3da4.js"><link rel="prefetch" href="/assets/js/234.e3678d9d.js"><link rel="prefetch" href="/assets/js/235.2a0a0895.js"><link rel="prefetch" href="/assets/js/236.92dbf8c2.js"><link rel="prefetch" href="/assets/js/237.4ca422e6.js"><link rel="prefetch" href="/assets/js/238.943f7e30.js"><link rel="prefetch" href="/assets/js/239.5764502f.js"><link rel="prefetch" href="/assets/js/24.483c917f.js"><link rel="prefetch" href="/assets/js/240.6a8f0e48.js"><link rel="prefetch" href="/assets/js/25.e8e9ec70.js"><link rel="prefetch" href="/assets/js/26.88a91885.js"><link rel="prefetch" href="/assets/js/27.9fea4e2f.js"><link rel="prefetch" href="/assets/js/28.406d2d78.js"><link rel="prefetch" href="/assets/js/29.cf1a3e8c.js"><link rel="prefetch" href="/assets/js/3.c2675a1e.js"><link rel="prefetch" href="/assets/js/30.26be9a48.js"><link rel="prefetch" href="/assets/js/31.35fc2866.js"><link rel="prefetch" href="/assets/js/32.28f48bcf.js"><link rel="prefetch" href="/assets/js/33.b336b8d1.js"><link rel="prefetch" href="/assets/js/34.c2c07637.js"><link rel="prefetch" href="/assets/js/35.2a136f24.js"><link rel="prefetch" href="/assets/js/36.76a4be97.js"><link rel="prefetch" href="/assets/js/37.97cbe2c4.js"><link rel="prefetch" href="/assets/js/38.1b05e42a.js"><link rel="prefetch" href="/assets/js/39.27deb40d.js"><link rel="prefetch" href="/assets/js/4.064e3e74.js"><link rel="prefetch" href="/assets/js/40.30113835.js"><link rel="prefetch" href="/assets/js/41.5c15f390.js"><link rel="prefetch" href="/assets/js/42.74e05b38.js"><link rel="prefetch" href="/assets/js/43.80f63783.js"><link rel="prefetch" href="/assets/js/44.e840eebc.js"><link rel="prefetch" href="/assets/js/45.35ad9365.js"><link rel="prefetch" href="/assets/js/46.b1c139a8.js"><link rel="prefetch" href="/assets/js/47.ddb0e03b.js"><link rel="prefetch" href="/assets/js/48.4d21dde2.js"><link rel="prefetch" href="/assets/js/49.f5b8c77a.js"><link rel="prefetch" href="/assets/js/5.e389fe4a.js"><link rel="prefetch" href="/assets/js/50.35e729ec.js"><link rel="prefetch" href="/assets/js/51.44cfd51f.js"><link rel="prefetch" href="/assets/js/52.c44eedc0.js"><link rel="prefetch" href="/assets/js/53.b88c2f67.js"><link rel="prefetch" href="/assets/js/54.6a675a69.js"><link rel="prefetch" href="/assets/js/55.f2075812.js"><link rel="prefetch" href="/assets/js/56.10013505.js"><link rel="prefetch" href="/assets/js/57.eed6e76e.js"><link rel="prefetch" href="/assets/js/58.b9725f17.js"><link rel="prefetch" href="/assets/js/59.47d2fc3d.js"><link rel="prefetch" href="/assets/js/60.bf3cc3b2.js"><link rel="prefetch" href="/assets/js/61.9a71ec44.js"><link rel="prefetch" href="/assets/js/62.f2d51a50.js"><link rel="prefetch" href="/assets/js/63.43350cb5.js"><link rel="prefetch" href="/assets/js/64.6e75578d.js"><link rel="prefetch" href="/assets/js/65.7bc53507.js"><link rel="prefetch" href="/assets/js/66.15913868.js"><link rel="prefetch" href="/assets/js/67.7aaa0ff4.js"><link rel="prefetch" href="/assets/js/68.75ed53a1.js"><link rel="prefetch" href="/assets/js/69.b2937f76.js"><link rel="prefetch" href="/assets/js/7.43582890.js"><link rel="prefetch" href="/assets/js/70.44e662a7.js"><link rel="prefetch" href="/assets/js/71.5180b37c.js"><link rel="prefetch" href="/assets/js/72.3fbee102.js"><link rel="prefetch" href="/assets/js/73.1dd4b627.js"><link rel="prefetch" href="/assets/js/74.4a42c684.js"><link rel="prefetch" href="/assets/js/75.7d74edbf.js"><link rel="prefetch" href="/assets/js/76.6011503e.js"><link rel="prefetch" href="/assets/js/77.cc4a6f8d.js"><link rel="prefetch" href="/assets/js/78.13125d6b.js"><link rel="prefetch" href="/assets/js/79.00c262ec.js"><link rel="prefetch" href="/assets/js/8.bd29fdb6.js"><link rel="prefetch" href="/assets/js/80.b828807f.js"><link rel="prefetch" href="/assets/js/81.7c72e7d8.js"><link rel="prefetch" href="/assets/js/82.24facf6a.js"><link rel="prefetch" href="/assets/js/83.df235aa4.js"><link rel="prefetch" href="/assets/js/84.d291a5a4.js"><link rel="prefetch" href="/assets/js/85.b08164c3.js"><link rel="prefetch" href="/assets/js/86.c0b7d5dd.js"><link rel="prefetch" href="/assets/js/87.1f329427.js"><link rel="prefetch" href="/assets/js/88.83d41a38.js"><link rel="prefetch" href="/assets/js/89.1ae9e493.js"><link rel="prefetch" href="/assets/js/9.cb12b117.js"><link rel="prefetch" href="/assets/js/90.03bdddf0.js"><link rel="prefetch" href="/assets/js/91.2ddb53fb.js"><link rel="prefetch" href="/assets/js/92.98eb8519.js"><link rel="prefetch" href="/assets/js/93.3650d214.js"><link rel="prefetch" href="/assets/js/94.2b956910.js"><link rel="prefetch" href="/assets/js/95.ff6c367c.js"><link rel="prefetch" href="/assets/js/96.1174ca7f.js"><link rel="prefetch" href="/assets/js/97.447ad308.js"><link rel="prefetch" href="/assets/js/98.c537a9b3.js"><link rel="prefetch" href="/assets/js/99.dc8ab06e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74392c83.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ğŸ“–Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="âš¡ç³»åˆ—æ–‡ç« " class="dropdown-title"><span class="title">âš¡ç³»åˆ—æ–‡ç« </span> <span class="arrow down"></span></button> <button type="button" aria-label="âš¡ç³»åˆ—æ–‡ç« " class="mobile-dropdown-title"><span class="title">âš¡ç³»åˆ—æ–‡ç« </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  ğŸš€åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›®
</a></li></ul></div></div><div class="nav-item"><a href="/python/" class="nav-link">
  ğŸˆPython
</a></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  ğŸºæŠ€æœ¯æ ˆ
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  ğŸ‰æ€»ç»“
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ‘é˜¿æ˜ŸPlus" class="dropdown-title"><span class="title">ğŸ‘é˜¿æ˜ŸPlus</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ‘é˜¿æ˜ŸPlus" class="mobile-dropdown-title"><span class="title">ğŸ‘é˜¿æ˜ŸPlus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs.meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/meowv/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlus - åšå®¢å›­
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/3122268756261864" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlus - æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/Tencentgou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlusçš„å¾®åš
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://api.meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  api.meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.nuget.org/profiles/qix/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet Gallery | qix
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    â­ï¸GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="âš¡ç³»åˆ—æ–‡ç« " class="dropdown-title"><span class="title">âš¡ç³»åˆ—æ–‡ç« </span> <span class="arrow down"></span></button> <button type="button" aria-label="âš¡ç³»åˆ—æ–‡ç« " class="mobile-dropdown-title"><span class="title">âš¡ç³»åˆ—æ–‡ç« </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  ğŸš€åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›®
</a></li></ul></div></div><div class="nav-item"><a href="/python/" class="nav-link">
  ğŸˆPython
</a></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  ğŸºæŠ€æœ¯æ ˆ
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  ğŸ‰æ€»ç»“
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ‘é˜¿æ˜ŸPlus" class="dropdown-title"><span class="title">ğŸ‘é˜¿æ˜ŸPlus</span> <span class="arrow down"></span></button> <button type="button" aria-label="ğŸ‘é˜¿æ˜ŸPlus" class="mobile-dropdown-title"><span class="title">ğŸ‘é˜¿æ˜ŸPlus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://docs.meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs.meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/meowv/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlus - åšå®¢å›­
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/3122268756261864" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlus - æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/Tencentgou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  é˜¿æ˜ŸPlusçš„å¾®åš
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://api.meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  api.meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.nuget.org/profiles/qix/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet Gallery | qix
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    â­ï¸GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>.NET Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/stack/dotnetcore/abp-template.html" class="sidebar-link">åŸºäº abp vNext çš„å¿«é€Ÿå¼€å‘æ¨¡æ¿</a></li><li><a href="/stack/dotnetcore/autoapi.html" class="sidebar-link">åŠ¨æ€ Restful API ç”Ÿæˆ</a></li><li><a href="/stack/dotnetcore/import-and-export-excel.html" class="sidebar-link">.NET Core ä¸­å¯¼å…¥å¯¼å‡ºExcel</a></li><li><a href="/stack/dotnetcore/captcha.html" class="sidebar-link">.NET Core ä¸­ç”ŸæˆéªŒè¯ç </a></li><li><a href="/stack/dotnetcore/mailkit.html" class="sidebar-link">.NET Core ä¸‹æ”¶å‘é‚®ä»¶ä¹‹ MailKit</a></li><li><a href="/stack/dotnetcore/qrcode.html" class="sidebar-link">.NET Core ç”ŸæˆäºŒç»´ç </a></li><li><a href="/stack/dotnetcore/swagger.html" class="sidebar-link">.NET Core APIæ–‡æ¡£ç®¡ç†ç»„ä»¶ Swagger</a></li><li><a href="/stack/dotnetcore/json-web-token.html" class="sidebar-link">.NET Core é›†æˆJWTè®¤è¯</a></li><li><a href="/stack/dotnetcore/spider.html" class="sidebar-link">.NET Core ä¸‹çš„çˆ¬è™«åˆ©å™¨</a></li><li><a href="/stack/dotnetcore/apollo-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ Apollo é…ç½®ä¸­å¿ƒ</a></li><li><a href="/stack/dotnetcore/grpc-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ gRPC</a></li><li><a href="/stack/dotnetcore/elasticsearch-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ ElasticSearch</a></li><li><a href="/stack/dotnetcore/rabbitmq-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ RabbitMQ</a></li><li><a href="/stack/dotnetcore/kafka-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ Kafka</a></li><li><a href="/stack/dotnetcore/log4net-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ Log4Net è®°å½•æ—¥å¿—</a></li><li><a href="/stack/dotnetcore/nlog-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ NLog è®°å½•æ—¥å¿—</a></li><li><a href="/stack/dotnetcore/serilog-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ Serilog è®°å½•æ—¥å¿—</a></li><li><a href="/stack/dotnetcore/exceptionless-in-dotnet.html" class="sidebar-link">.NET Core ä¸‹ä½¿ç”¨ Exceptionless è®°å½•æ—¥å¿—</a></li><li><a href="/stack/dotnetcore/consul.html" aria-current="page" class="active sidebar-link">.NET Core ä½¿ç”¨ Consul æœåŠ¡æ³¨å†Œå‘ç°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#å®‰è£…" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#å¿«é€Ÿä½¿ç”¨" class="sidebar-link">å¿«é€Ÿä½¿ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#æœåŠ¡æ³¨å†Œ" class="sidebar-link">æœåŠ¡æ³¨å†Œ</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#æœåŠ¡å‘ç°" class="sidebar-link">æœåŠ¡å‘ç°</a></li></ul></li></ul></li><li><a href="/stack/dotnetcore/api-gateway.html" class="sidebar-link">.NET Core ä¸‹çš„ API ç½‘å…³</a></li><li><a href="/stack/dotnetcore/mta-package.html" class="sidebar-link">ä½¿ç”¨MTA HTML5ç»Ÿè®¡APIæ¥åˆ†ææ•°æ®</a></li><li><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html" class="sidebar-link">.NET Core ä¸‹æ“ä½œ Gitï¼Œè‡ªåŠ¨æäº¤ä»£ç åˆ° GitHub</a></li><li><a href="/stack/dotnetcore/epplus-wps-error.html" class="sidebar-link">EPPlus.Core å¤„ç† Excel æŠ¥é”™ä¹‹å¤©å‘ WPS</a></li><li><a href="/stack/dotnetcore/publish-to-centos.html" class="sidebar-link">åŸºäº.NET Coreå¼€å‘çš„ä¸ªäººåšå®¢ å‘å¸ƒè‡³CentOSå°è®¡</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blazor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Planning Analytics</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="net-core-ä½¿ç”¨-consul-æœåŠ¡æ³¨å†Œå‘ç°"><a href="#net-core-ä½¿ç”¨-consul-æœåŠ¡æ³¨å†Œå‘ç°" class="header-anchor">#</a> .NET Core ä½¿ç”¨ Consul æœåŠ¡æ³¨å†Œå‘ç°</h1> <p><code>Consul</code>æ˜¯ä¸€ä¸ªç”¨æ¥å®ç°åˆ†å¸ƒå¼ç³»ç»ŸæœåŠ¡å‘ç°ä¸é…ç½®çš„å¼€æºå·¥å…·ã€‚å®ƒå†…ç½®äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æ¡†æ¶ã€åˆ†å¸ƒä¸€è‡´æ€§åè®®å®ç°ã€å¥åº·æ£€æŸ¥ã€Key/Valueå­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒæ–¹æ¡ˆï¼Œä¸å†éœ€è¦ä¾èµ–å…¶ä»–å·¥å…·ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿè¾ƒä¸ºç®€å•ã€‚</p> <ul><li><code>Consul</code>å®˜ç½‘ï¼š<a href="https://www.consul.io" target="_blank" rel="noopener noreferrer">https://www.consul.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¼€æºåœ°å€ï¼š<a href="https://github.com/hashicorp/consul" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/consul<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://github.com/G-Research/consuldotnet" target="_blank" rel="noopener noreferrer">https://github.com/G-Research/consuldotnet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h2> <p><code>Consul</code>æ”¯æŒå„ç§å¹³å°çš„å®‰è£…ï¼Œå®‰è£…æ–‡æ¡£ï¼š<a href="https://www.consul.io/downloads" target="_blank" rel="noopener noreferrer">https://www.consul.io/downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œä¸ºäº†å¿«é€Ÿä½¿ç”¨ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ç”¨<a href="/stack/docker/repo/consul.html">dockeræ–¹å¼å®‰è£…</a>ã€‚</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">service_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>bootstrap<span class="token punctuation">-</span>expect=3 <span class="token punctuation">-</span>node=service_1
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_1<span class="token punctuation">:</span>/data
  <span class="token key atrule">service_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>node=service_2
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_2<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_1
  <span class="token key atrule">service_3</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>node=service_3
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_3<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_1
  <span class="token key atrule">client_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>ui <span class="token punctuation">-</span>node=client_1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8500<span class="token punctuation">:</span><span class="token number">8500</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/client_1<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_2
      <span class="token punctuation">-</span> service_3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>æä¾›ä¸€ä¸ª<code>docker-compose.yaml</code>ï¼Œä½¿ç”¨<code>docker-compose up</code>ç¼–æ’è„šæœ¬å¯åŠ¨<code>Consul</code>ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥é€‰æ‹©å…¶å®ƒæ–¹å¼èƒ½è¿è¡Œ<code>Consul</code>å³å¯ã€‚</p> <p><img src="/assets/img/consul-01.c68f91f8.png" alt=" "></p> <p>è¿™é‡Œä½¿ç”¨ Docker æ­å»º 3ä¸ª server èŠ‚ç‚¹ + 1 ä¸ª client èŠ‚ç‚¹ï¼ŒAPI æœåŠ¡é€šè¿‡ client èŠ‚ç‚¹è¿›è¡ŒæœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚</p> <p>å®‰è£…å®Œæˆå¯åŠ¨<code>Consul</code>ï¼Œæ‰“å¼€é»˜è®¤åœ°å€ <a href="http://localhost:8500" target="_blank" rel="noopener noreferrer">http://localhost:8500<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å¯ä»¥çœ‹åˆ°<code>Consul</code>uiç•Œé¢ã€‚</p> <p><img src="/assets/img/consul-02.92c417cc.png" alt=" "></p> <h2 id="å¿«é€Ÿä½¿ç”¨"><a href="#å¿«é€Ÿä½¿ç”¨" class="header-anchor">#</a> å¿«é€Ÿä½¿ç”¨</h2> <p>æ·»åŠ ä¸¤ä¸ªwebapiæœåŠ¡ï¼ŒServiceAå’ŒServiceBï¼Œä¸€ä¸ªwebapiå®¢æˆ·ç«¯Clientæ¥è°ƒç”¨æœåŠ¡ã€‚</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>dotnet new sln -n consul_demo

dotnet new webapi -n ServiceA
dotnet sln <span class="token function">add</span> ServiceA/ServiceA.csproj

dotnet new webapi -n ServiceB
dotnet sln <span class="token function">add</span> ServiceB/ServiceB.csproj

dotnet new webapi -n Client
dotnet sln <span class="token function">add</span> Client/Client.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/assets/img/consul-03.27b4a26b.png" alt=" "></p> <p>åœ¨é¡¹ç›®ä¸­æ·»åŠ <code>Consul</code>ç»„ä»¶åŒ…</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token function">Install-Package</span> Consul
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="header-anchor">#</a> æœåŠ¡æ³¨å†Œ</h3> <p>æ¥ä¸‹æ¥åœ¨ä¸¤ä¸ªæœåŠ¡ä¸­æ·»åŠ å¿…è¦çš„ä»£ç æ¥å®ç°å°†æœåŠ¡æ³¨å†Œåˆ°<code>Consul</code>ä¸­ã€‚</p> <p>é¦–å…ˆå°†<code>Consul</code>é…ç½®ä¿¡æ¯æ·»åŠ åˆ°<code>appsettings.json</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Consul&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://host.docker.internal:8500&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;HealthCheck&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/healthcheck&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;host.docker.internal&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å› ä¸ºæˆ‘ä»¬è¦å°†é¡¹ç›®éƒ½è¿è¡Œåœ¨dockerä¸­ï¼Œæ‰€ä»¥è¿™é‡Œçš„åœ°å€è¦ç”¨ host.docker.internal ä»£æ›¿ï¼Œä½¿ç”¨ localhost æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œå¦‚æœä¸åœ¨ docker ä¸­è¿è¡Œï¼Œè¿™é‡Œå°±é…ç½®å±‚ localhostã€‚</p> <p>æ·»åŠ ä¸€ä¸ªæ‰©å±•æ–¹æ³•<code>UseConul(this IApplicationBuilder app, IConfiguration configuration, IHostApplicationLifetime lifetime)</code>ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Consul</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Extensions</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IApplicationBuilder</span> <span class="token function">UseConul</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">IHostApplicationLifetime</span> lifetime<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsulClient</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Address&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Consulå®¢æˆ·ç«¯åœ°å€</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AgentServiceRegistration</span>
            <span class="token punctuation">{</span>
                ID <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å”¯ä¸€Id</span>
                Name <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡å</span>
                Address <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Ip&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡ç»‘å®šIP</span>
                Port <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡ç»‘å®šç«¯å£</span>
                Check <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AgentServiceCheck</span>
                <span class="token punctuation">{</span>
                    DeregisterCriticalServiceAfter <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡å¯åŠ¨å¤šä¹…åæ³¨å†Œ</span>
                    Interval <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å¥åº·æ£€æŸ¥æ—¶é—´é—´éš”</span>
                    HTTP <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Ip&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:HealthCheck&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> <span class="token comment">// å¥åº·æ£€æŸ¥åœ°å€</span>
                    Timeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// è¶…æ—¶æ—¶é—´</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token comment">// æ³¨å†ŒæœåŠ¡</span>
            client<span class="token punctuation">.</span>Agent<span class="token punctuation">.</span><span class="token function">ServiceRegister</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åº”ç”¨ç¨‹åºç»ˆæ­¢æ—¶ï¼Œå–æ¶ˆæœåŠ¡æ³¨å†Œ</span>
            lifetime<span class="token punctuation">.</span>ApplicationStopping<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                client<span class="token punctuation">.</span>Agent<span class="token punctuation">.</span><span class="token function">ServiceDeregister</span><span class="token punctuation">(</span>registration<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>ç„¶ååœ¨<code>Startup.cs</code>ä¸­ä½¿ç”¨æ‰©å±•æ–¹æ³•å³å¯ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">IHostApplicationLifetime</span> lifetime<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    app<span class="token punctuation">.</span><span class="token function">UseConul</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">,</span> lifetime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ³¨æ„ï¼Œè¿™é‡Œå°†<code>IConfiguration</code>å’Œ<code>IHostApplicationLifetime</code>ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„ï¼Œæ ¹æ®å®é™…å¼€å‘åšå¯¹åº”çš„ä¿®æ”¹å°±å¯ä»¥äº†ã€‚</p> <p>åˆ†åˆ«åœ¨ServiceAå’ŒServiceBéƒ½å®Œæˆä¸€éä¸Šè¿°æ“ä½œï¼Œå› ä¸ºä¸æ˜¯å®é™…é¡¹ç›®ï¼Œè¿™é‡Œå°±äº§ç”Ÿçš„è®¸å¤šé‡å¤ä»£ç ï¼Œåœ¨çœŸæ­£çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥è€ƒè™‘æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ä¸­ï¼ŒServiceAå’ŒServiceBåˆ†åˆ«å¼•ç”¨ï¼Œè°ƒç”¨ã€‚</p> <p>æ¥ç€å»å®ç°å¥åº·æ£€æŸ¥æ¥å£ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceA</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthCheckController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// å¥åº·æ£€æŸ¥</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceB</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceB<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthCheckController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// å¥åº·æ£€æŸ¥</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æœ€ååœ¨ServiceAå’ŒServiceBä¸­éƒ½æ·»åŠ ä¸€ä¸ªæ¥å£ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceA</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceAController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;æˆ‘æ˜¯</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>ServiceA<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">ï¼Œå½“å‰æ—¶é—´ï¼š</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token format-string"><span class="token punctuation">:</span>G</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
                ip <span class="token operator">=</span> Request<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Connection<span class="token punctuation">.</span>LocalIpAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                port <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceB</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceB<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceBController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;æˆ‘æ˜¯</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>ServiceB<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">ï¼Œå½“å‰æ—¶é—´ï¼š</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token format-string"><span class="token punctuation">:</span>G</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
                ip <span class="token operator">=</span> Request<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Connection<span class="token punctuation">.</span>LocalIpAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                port <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>è¿™æ ·æˆ‘ä»¬å†™äº†ä¸¤ä¸ªæœåŠ¡ï¼ŒServiceAå’ŒServiceBã€‚éƒ½æ·»åŠ äº†å¥åº·æ£€æŸ¥æ¥å£å’Œä¸€ä¸ªè‡ªå·±çš„æœåŠ¡æ¥å£ï¼Œè¿”å›ä¸€æ®µjsonã€‚</p> <p>æˆ‘ä»¬ç°åœ¨æ¥è¿è¡Œçœ‹çœ‹æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹å¼ï¼Œåªè¦èƒ½å¯åŠ¨å³å¯ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©åœ¨dockerä¸­è¿è¡Œï¼Œç›´æ¥åœ¨ Visual Studioä¸­å¯¹ç€ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆå³é”®æ·»åŠ ï¼Œé€‰æ‹©Dockeræ”¯æŒï¼Œé»˜è®¤ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºå¥½Dockfileï¼Œéå¸¸æ–¹ä¾¿ã€‚</p> <p>ç”Ÿæˆçš„Dockfileæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># ServiceA</span>
<span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet<span class="token punctuation">:</span>3.1<span class="token punctuation">-</span>buster<span class="token punctuation">-</span>slim AS base
<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">EXPOSE</span> 80
<span class="token keyword">EXPOSE</span> 443

<span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk<span class="token punctuation">:</span>3.1<span class="token punctuation">-</span>buster AS build
<span class="token keyword">WORKDIR</span> /src
<span class="token keyword">COPY</span> <span class="token punctuation">[</span><span class="token string">&quot;ServiceA/ServiceA.csproj&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceA/&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;ServiceA/ServiceA.csproj&quot;</span>
<span class="token keyword">COPY</span> . .
<span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/ServiceA&quot;</span>
<span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;ServiceA.csproj&quot;</span> <span class="token punctuation">-</span>c Release <span class="token punctuation">-</span>o /app/build

<span class="token keyword">FROM</span> build AS publish
<span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;ServiceA.csproj&quot;</span> <span class="token punctuation">-</span>c Release <span class="token punctuation">-</span>o /app/publish

<span class="token keyword">FROM</span> base AS final
<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=publish /app/publish .
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;dotnet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceA.dll&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># ServiceB</span>
<span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet<span class="token punctuation">:</span>3.1<span class="token punctuation">-</span>buster<span class="token punctuation">-</span>slim AS base
<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">EXPOSE</span> 80
<span class="token keyword">EXPOSE</span> 443

<span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk<span class="token punctuation">:</span>3.1<span class="token punctuation">-</span>buster AS build
<span class="token keyword">WORKDIR</span> /src
<span class="token keyword">COPY</span> <span class="token punctuation">[</span><span class="token string">&quot;ServiceB/ServiceB.csproj&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceB/&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;ServiceB/ServiceB.csproj&quot;</span>
<span class="token keyword">COPY</span> . .
<span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/ServiceB&quot;</span>
<span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;ServiceB.csproj&quot;</span> <span class="token punctuation">-</span>c Release <span class="token punctuation">-</span>o /app/build

<span class="token keyword">FROM</span> build AS publish
<span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;ServiceB.csproj&quot;</span> <span class="token punctuation">-</span>c Release <span class="token punctuation">-</span>o /app/publish

<span class="token keyword">FROM</span> base AS final
<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=publish /app/publish .
<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;dotnet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceB.dll&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ç„¶åå®šä½åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œä½¿ç”¨å‘½ä»¤å»ç¼–è¯‘ä¸¤ä¸ªé•œåƒï¼Œservice_aå’Œservice_b</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>docker build -t service_a:dev -f ./ServiceA/Dockerfile <span class="token builtin class-name">.</span>

docker build -t service_b:dev -f ./ServiceB/Dockerfile <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/consul-04.e9d5ad0c.png" alt=" "></p> <p>çœ‹åˆ° Successfully å°±æˆåŠŸäº†ï¼Œé€šè¿‡<code>docker image ls</code>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰“åŒ…çš„ä¸¤ä¸ªé•œåƒã€‚</p> <p><img src="/assets/img/consul-05.2975ecd5.png" alt=" "></p> <p>è¿™é‡Œé¡ºä¾¿æä¸€å¥ï¼Œå·²ç»å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç¼–è¯‘çš„é•œåƒï¼Œservice_aå’Œservice_bäº†ï¼Œä½†æ˜¯è¿˜æœ‰è®¸å¤šåç§°ä¸º<code>&lt;none&gt;</code>çš„é•œåƒï¼Œè¿™äº›é•œåƒå¯ä»¥ä¸ç”¨ç®¡å®ƒï¼Œè¿™ç§å«åšè™šæ‚¬é•œåƒï¼Œæ—¢æ²¡æœ‰ä»“åº“åï¼Œä¹Ÿæ²¡æœ‰æ ‡ç­¾ã€‚æ˜¯å› ä¸º<code>docker build</code>å¯¼è‡´çš„è¿™ç§ç°è±¡ã€‚ç”±äºæ–°æ—§é•œåƒåŒåï¼Œæ—§é•œåƒåç§°è¢«å–æ¶ˆï¼Œä»è€Œå‡ºç°ä»“åº“åã€æ ‡ç­¾å‡ä¸º <code>&lt;none&gt;</code> çš„é•œåƒã€‚</p> <p>ä¸€èˆ¬æ¥è¯´ï¼Œè™šæ‚¬é•œåƒå·²ç»å¤±å»äº†å­˜åœ¨çš„ä»·å€¼ï¼Œæ˜¯å¯ä»¥éšæ„åˆ é™¤çš„ï¼Œå¯ä»¥<code>docker image prune</code>å‘½ä»¤åˆ é™¤ï¼Œè¿™æ ·é•œåƒåˆ—è¡¨å°±å¹²å‡€å¤šäº†ã€‚</p> <p>æœ€åå°†ä¸¤ä¸ªé•œåƒservice_aå’Œservice_bï¼Œåˆ†åˆ«è¿è¡Œä¸‰ä¸ªå®ä¾‹ã€‚</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5050:80 <span class="token operator">--</span>name service_a1 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5050&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5051:80 <span class="token operator">--</span>name service_a2 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5051&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5052:80 <span class="token operator">--</span>name service_a3 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5052&quot;</span>

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5060:80 <span class="token operator">--</span>name service_b1 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5060&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5061:80 <span class="token operator">--</span>name service_b2 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5061&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5062:80 <span class="token operator">--</span>name service_b3 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5062&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/consul-06.a7e59de6.png" alt=" "></p> <p>è¿è¡ŒæˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼Œå»åˆ°<code>Consul</code>çœ‹çœ‹ã€‚</p> <p><img src="/assets/img/consul-07.fadc8a5b.png" alt=" "> <img src="/assets/img/consul-08.3da98b2d.png" alt=" "> <img src="/assets/img/consul-09.12728f27.png" alt=" "></p> <p>æˆåŠŸå°†ä¸¤ä¸ªæœåŠ¡æ³¨å†Œåˆ°<code>Consul</code>ï¼Œå¹¶ä¸”æ¯ä¸ªæœåŠ¡éƒ½æœ‰å¤šä¸ªå®ä¾‹ã€‚</p> <p>è®¿é—®ä¸€ä¸‹æ¥å£è¯•è¯•å§ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æˆåŠŸå‡ºç°ç»“æœã€‚</p> <p><img src="/assets/img/consul-10.5702fb8f.png" alt=" "></p> <p>å› ä¸ºç»ˆç«¯ç¼–ç é—®é¢˜ï¼Œå¯¼è‡´æ˜¾ç¤ºä¹±ç ï¼Œè¿™ä¸ªä¸å½±å“ï¼Œokï¼Œè‡³æ­¤æœåŠ¡æ³¨å†Œå¤§åŠŸå‘Šæˆã€‚</p> <h3 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="header-anchor">#</a> æœåŠ¡å‘ç°</h3> <p>æå®šäº†æœåŠ¡æ³¨å†Œï¼Œæ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•æœåŠ¡å‘ç°ï¼Œåœ¨Clienté¡¹ç›®ä¸­å…ˆå°†<code>Consul</code>åœ°å€é…ç½®åˆ°<code>appsettings.json</code>ä¸­ã€‚</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Consul&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://host.docker.internal:8500&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç„¶åæ·»åŠ ä¸€ä¸ªæ¥å£ï¼Œ<code>IService.cs</code>ï¼Œæ·»åŠ ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«è·å–ä¸¤ä¸ªæœåŠ¡çš„è¿”å›ç»“æœä»¥åŠåˆå§‹åŒ–æœåŠ¡çš„æ–¹æ³•ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IService</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// è·å– ServiceA è¿”å›æ•°æ®</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// è·å– ServiceB è¿”å›æ•°æ®</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// åˆå§‹åŒ–æœåŠ¡</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>å®ç°ç±»ï¼š<code>Service.cs</code></p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Concurrent</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Consul</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IService</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IConfiguration</span> _configuration<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ConsulClient</span> _consulClient<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _serviceAUrls<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _serviceBUrls<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">IHttpClientFactory</span> _httpClient<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Service</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">IHttpClientFactory</span> httpClient<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>

            _consulClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsulClient</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>_configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Address&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _httpClient <span class="token operator">=</span> httpClient<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_serviceAUrls <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceAæ­£åœ¨åˆå§‹åŒ–...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> httpClient <span class="token operator">=</span> _httpClient<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> serviceUrl <span class="token operator">=</span> _serviceAUrls<span class="token punctuation">.</span><span class="token function">ElementAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>_serviceAUrls<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceAï¼š&quot;</span> <span class="token operator">+</span> serviceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">serviceUrl</span><span class="token punctuation">}</span></span><span class="token string">/api/servicea&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_serviceBUrls <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceBæ­£åœ¨åˆå§‹åŒ–...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> httpClient <span class="token operator">=</span> _httpClient<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> serviceUrl <span class="token operator">=</span> _serviceBUrls<span class="token punctuation">.</span><span class="token function">ElementAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>_serviceBUrls<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceBï¼š&quot;</span> <span class="token operator">+</span> serviceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">serviceUrl</span><span class="token punctuation">}</span></span><span class="token string">/api/serviceb&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> serviceNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceB&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> serviceNames<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> queryOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryOptions</span>
                    <span class="token punctuation">{</span>
                        WaitTime <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">await</span> <span class="token function">InitServicesAsync</span><span class="token punctuation">(</span>queryOptions<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">InitServicesAsync</span><span class="token punctuation">(</span><span class="token class-name">QueryOptions</span> queryOptions<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> serviceName<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> _consulClient<span class="token punctuation">.</span>Health<span class="token punctuation">.</span><span class="token function">Service</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> queryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>queryOptions<span class="token punctuation">.</span>WaitIndex <span class="token operator">!=</span> result<span class="token punctuation">.</span>LastIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    queryOptions<span class="token punctuation">.</span>WaitIndex <span class="token operator">=</span> result<span class="token punctuation">.</span>LastIndex<span class="token punctuation">;</span>

                    <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> result<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Address</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Port</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceName <span class="token operator">==</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        _serviceAUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceName <span class="token operator">==</span> <span class="token string">&quot;ServiceB&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        _serviceBUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><p>ä»£ç å°±ä¸è§£é‡Šäº†ï¼Œç›¸ä¿¡éƒ½å¯ä»¥çœ‹æ‡‚ï¼Œä½¿ç”¨äº†<code>Random</code>ç±»éšæœºè·å–ä¸€ä¸ªæœåŠ¡ï¼Œå…³äºè¿™ç‚¹å¯ä»¥é€‰æ‹©æ›´åˆé€‚çš„è´Ÿè½½å‡è¡¡æ–¹å¼ã€‚</p> <p>åœ¨<code>Startup.cs</code>ä¸­æ·»åŠ æ¥å£ä¾èµ–æ³¨å…¥ã€ä½¿ç”¨åˆå§‹åŒ–æœåŠ¡ç­‰ä»£ç ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">Startup</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IService<span class="token punctuation">,</span> Service<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">IService</span> service<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                endpoints<span class="token punctuation">.</span><span class="token function">MapControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            service<span class="token punctuation">.</span><span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>ä¸€åˆ‡å°±ç»ªï¼Œæ·»åŠ apiè®¿é—®æˆ‘ä»¬çš„ä¸¤ä¸ªæœåŠ¡ã€‚</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;service_result&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">GetService</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IService</span> service<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                serviceA <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                serviceB <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ç›´æ¥åœ¨Visual Studioä¸­è¿è¡ŒClienté¡¹ç›®ï¼Œåœ¨æµè§ˆå™¨è®¿é—®apiã€‚</p> <p><img src="/assets/img/consul-11.a1fa2219.png" alt=" "></p> <p>å¤§åŠŸå‘Šæˆï¼ŒæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œç°åœ¨å°±ç®—ä¹‹ä¸­çš„æŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼ŒæœåŠ¡ä¹Ÿå¯ä»¥ç…§å¸¸è¿è¡Œã€‚</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/meowv/docs/edit/master//stack/dotnetcore/consul.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">a year ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/stack/dotnetcore/exceptionless-in-dotnet.html" class="prev">
        .NET Core ä¸‹ä½¿ç”¨ Exceptionless è®°å½•æ—¥å¿—
      </a></span> <span class="next"><a href="/stack/dotnetcore/api-gateway.html">
        .NET Core ä¸‹çš„ API ç½‘å…³
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><!----></div></div>
    <script src="/assets/js/app.e42d6934.js" defer></script><script src="/assets/js/2.887f4612.js" defer></script><script src="/assets/js/6.35ad950b.js" defer></script>
  </body>
</html>
