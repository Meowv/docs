(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{839:function(a,e,s){"use strict";s.r(e);var t=s(11),n=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"删除本地镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除本地镜像"}},[a._v("#")]),a._v(" 删除本地镜像")]),a._v(" "),s("p",[a._v("如果要删除本地的镜像，可以使用 "),s("code",[a._v("docker image rm")]),a._v(" 命令，其格式为：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("选项"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("镜像"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("1")]),a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("镜像"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"用-id、镜像名、摘要删除镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用-id、镜像名、摘要删除镜像"}},[a._v("#")]),a._v(" 用 ID、镜像名、摘要删除镜像")]),a._v(" "),s("p",[a._v("其中，"),s("code",[a._v("<镜像>")]),a._v(" 可以是 "),s("code",[a._v("镜像短 ID")]),a._v("、"),s("code",[a._v("镜像长 ID")]),a._v("、"),s("code",[a._v("镜像名")]),a._v(" 或者 "),s("code",[a._v("镜像摘要")]),a._v("。")]),a._v(" "),s("p",[a._v("比如我们有这么一些镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ncentos                      latest              0584b3d2cf6d        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("196.5")]),a._v(" MB\nredis                       alpine              501ad78535f0        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21.03")]),a._v(" MB\ndocker                      latest              cf693ec9b5c7        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("105.1")]),a._v(" MB\nnginx                       latest              e43d811ce2f4        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("181.5")]),a._v(" MB\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("我们可以用镜像的完整 ID，也称为 "),s("code",[a._v("长 ID")]),a._v("，来删除镜像。使用脚本的时候可能会用长 ID，但是人工输入就太累了，所以更多的时候是用 "),s("code",[a._v("短 ID")]),a._v(" 来删除镜像。"),s("code",[a._v("docker image ls")]),a._v(" 默认列出的就已经是短 ID 了，一般取前3个字符以上，只要足够区分于别的镜像就可以了。")]),a._v(" "),s("p",[a._v("比如这里，如果我们要删除 "),s("code",[a._v("redis:alpine")]),a._v(" 镜像，可以执行：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("501")]),a._v("\nUntagged: redis:alpine\nUntagged: redis@sha256:f1ed3708f538b537eb9c2a7dd50dc90a706f7debd7e1196c9264edeea521a86d\nDeleted: sha256:501ad78535f015d88872e13fa87a828425117e3d28075d0c117932b05bf189b7\nDeleted: sha256:96167737e29ca8e9d74982ef2a0dda76ed7b430da55e321c071f0dbff8c2899b\nDeleted: sha256:32770d1dcf835f192cafd6b9263b7b597a1778a403a109e2cc2ee866f74adf23\nDeleted: sha256:127227698ad74a5846ff5153475e03439d96d4b1c7f2a449c7a826ef74a2d2fa\nDeleted: sha256:1333ecc582459bac54e1437335c0816bc17634e131ea0cc48daa27d32c75eab3\nDeleted: sha256:4fc455b921edf9c4aea207c51ab39b10b06540c8b4825ba57b3feed1668fa7c7\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("我们也可以用"),s("code",[a._v("镜像名")]),a._v("，也就是 "),s("code",[a._v("<仓库名>:<标签>")]),a._v("，来删除镜像。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" centos\nUntagged: centos:latest\nUntagged: centos@sha256:b2f9d1c0ff5f87a4743104d099a3d561002ac500db1b9bfa02a783a46e0d366c\nDeleted: sha256:0584b3d2cf6d235ee310cf14b54667d889887b838d3f3d3033acd70fc3c48b8a\nDeleted: sha256:97ca462ad9eeae25941546209454496e1d66749d53dfa2ee32bf1faabd239d38\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("当然，更精确的是使用 "),s("code",[a._v("镜像摘要")]),a._v(" 删除镜像。")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" --digests\nREPOSITORY                  TAG                 DIGEST                                                                    IMAGE ID            CREATED             SIZE\nnode                        slim                sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228   6e0c4c8e3913        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" weeks ago         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("214")]),a._v(" MB\n\n$ docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228\nUntagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"untagged-和-deleted"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#untagged-和-deleted"}},[a._v("#")]),a._v(" Untagged 和 Deleted")]),a._v(" "),s("p",[a._v("如果观察上面这几个命令的运行输出信息的话，你会注意到删除行为分为两类，一类是 "),s("code",[a._v("Untagged")]),a._v("，另一类是 "),s("code",[a._v("Deleted")]),a._v("。我们之前介绍过，镜像的唯一标识是其 ID 和摘要，而一个镜像可以有多个标签。")]),a._v(" "),s("p",[a._v("因此当我们使用上面命令删除镜像的时候，实际上是在要求删除某个标签的镜像。所以首先需要做的是将满足我们要求的所有镜像标签都取消，这就是我们看到的 "),s("code",[a._v("Untagged")]),a._v(" 的信息。因为一个镜像可以对应多个标签，因此当我们删除了所指定的标签后，可能还有别的标签指向了这个镜像，如果是这种情况，那么 "),s("code",[a._v("Delete")]),a._v(" 行为就不会发生。所以并非所有的 "),s("code",[a._v("docker image rm")]),a._v(" 都会产生删除镜像的行为，有可能仅仅是取消了某个标签而已。")]),a._v(" "),s("p",[a._v("当该镜像所有的标签都被取消了，该镜像很可能会失去了存在的意义，因此会触发删除行为。镜像是多层存储结构，因此在删除的时候也是从上层向基础层方向依次进行判断删除。镜像的多层结构让镜像复用变得非常容易，因此很有可能某个其它镜像正依赖于当前镜像的某一层。这种情况，依旧不会触发删除该层的行为。直到没有任何层依赖当前层时，才会真实的删除当前层。这就是为什么，有时候会奇怪，为什么明明没有别的标签指向这个镜像，但是它还是存在的原因，也是为什么有时候会发现所删除的层数和自己 "),s("code",[a._v("docker pull")]),a._v(" 看到的层数不一样的原因。")]),a._v(" "),s("p",[a._v("除了镜像依赖以外，还需要注意的是容器对镜像的依赖。如果有用这个镜像启动的容器存在（即使容器没有运行），那么同样不可以删除这个镜像。之前讲过，容器是以镜像为基础，再加一层容器存储层，组成这样的多层存储结构去运行的。因此该镜像如果被这个容器所依赖的，那么删除必然会导致故障。如果这些容器是不需要的，应该先将它们删除，然后再来删除镜像。")]),a._v(" "),s("h2",{attrs:{id:"用-docker-image-ls-命令来配合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用-docker-image-ls-命令来配合"}},[a._v("#")]),a._v(" 用 docker image ls 命令来配合")]),a._v(" "),s("p",[a._v("像其它可以承接多个实体的命令一样，可以使用 "),s("code",[a._v("docker image ls -q")]),a._v(" 来配合使用 "),s("code",[a._v("docker image rm")]),a._v("，这样可以成批的删除希望删除的镜像。我们在“镜像列表”章节介绍过很多过滤镜像列表的方式都可以拿过来使用。")]),a._v(" "),s("p",[a._v("比如，我们需要删除所有仓库名为 "),s("code",[a._v("redis")]),a._v(" 的镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -q redis"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("或者删除所有在 "),s("code",[a._v("mongo:3.2")]),a._v(" 之前的镜像：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("docker image "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -q -f "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("before")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("mongo:3.2"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("充分利用你的想象力和 Linux 命令行的强大，你可以完成很多非常赞的功能。")])])}),[],!1,null,null,null);e.default=n.exports}}]);