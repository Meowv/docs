(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{858:function(s,a,t){"use strict";t.r(a);var e=t(11),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#私有仓库"}},[s._v("#")]),s._v(" 私有仓库")]),s._v(" "),t("p",[s._v("有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。")]),s._v(" "),t("p",[s._v("本节介绍如何使用本地仓库。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.docker.com/registry/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("docker-registry")]),t("OutboundLink")],1),s._v(" 是官方提供的工具，可以用于构建私有的镜像仓库。")]),s._v(" "),t("h2",{attrs:{id:"安装运行-docker-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装运行-docker-registry"}},[s._v("#")]),s._v(" 安装运行 docker-registry")]),s._v(" "),t("h3",{attrs:{id:"容器运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器运行"}},[s._v("#")]),s._v(" 容器运行")]),s._v(" "),t("p",[s._v("你可以通过获取官方 "),t("code",[s._v("registry")]),s._v(" 镜像来运行。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --name registry registry\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这将使用官方的 "),t("code",[s._v("registry")]),s._v(" 镜像来启动私有仓库。默认情况下，仓库会被创建在容器的 "),t("code",[s._v("/var/lib/registry")]),s._v(" 目录下。你可以通过 "),t("code",[s._v("-v")]),s._v(" 参数来将镜像文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 "),t("code",[s._v("/opt/data/registry")]),s._v(" 目录。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker run -d "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /opt/data/registry:/var/lib/registry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    registry\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"在私有仓库上传、搜索、下载镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在私有仓库上传、搜索、下载镜像"}},[s._v("#")]),s._v(" 在私有仓库上传、搜索、下载镜像")]),s._v(" "),t("p",[s._v("创建好私有仓库之后，就可以使用 "),t("code",[s._v("docker tag")]),s._v(" 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 "),t("code",[s._v("127.0.0.1:5000")]),s._v("。")]),s._v(" "),t("p",[s._v("先在本机查看已有的镜像。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                            latest              ba5877dc9bec        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("docker tag")]),s._v(" 将 "),t("code",[s._v("ubuntu:latest")]),s._v(" 这个镜像标记为 "),t("code",[s._v("127.0.0.1:5000/ubuntu:latest")]),s._v("。")]),s._v(" "),t("p",[s._v("格式为 "),t("code",[s._v("docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker tag ubuntu:latest "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\n$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                        TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                            latest              ba5877dc9bec        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest      latest              ba5877dc9bec        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("docker push")]),s._v(" 上传标记的镜像。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker push "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nThe push refers to repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n373a30c24545: Pushed\na9148f5200b0: Pushed\ncdd3de0940ab: Pushed\nfc56279bbb33: Pushed\nb38367233d37: Pushed\n2aebd096e0e2: Pushed\nlatest: digest: sha256:fe4277621f10b5026266932ddf760f5a756d2facd505a94d2da12f4f52f71f5a size: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1568")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("用 "),t("code",[s._v("curl")]),s._v(" 查看仓库中的镜像。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/v2/_catalog\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repositories"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ubuntu"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这里可以看到 "),t("code",[s._v('{"repositories":["ubuntu"]}')]),s._v("，表明镜像已经被成功上传了。")]),s._v(" "),t("p",[s._v("先删除已有镜像，再尝试从私有仓库中下载这个镜像。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\n\n$ docker pull "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nPulling repository "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nba5877dc9bec: Download complete\n511136ea3c5a: Download complete\n9bad880da3d2: Download complete\n25f11f5fb0cb: Download complete\nebc34468f71d: Download complete\n2318d26665ef: Download complete\n\n$ docker image "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest       latest              ba5877dc9bec        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[s._v("#")]),s._v(" 注意事项")]),s._v(" "),t("p",[s._v("如果你不想使用 "),t("code",[s._v("127.0.0.1:5000")]),s._v(" 作为仓库地址，比如想让本网段的其他主机也能把镜像推送到私有仓库。你就得把例如 "),t("code",[s._v("192.168.199.100:5000")]),s._v(" 这样的内网地址作为私有仓库地址，这时你会发现无法成功推送镜像。")]),s._v(" "),t("p",[s._v("这是因为 Docker 默认不允许非 "),t("code",[s._v("HTTPS")]),s._v(" 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制，或者查看下一节配置能够通过 "),t("code",[s._v("HTTPS")]),s._v(" 访问的私有仓库。")]),s._v(" "),t("h3",{attrs:{id:"ubuntu-16-04-debian-8-centos-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-16-04-debian-8-centos-7"}},[s._v("#")]),s._v(" Ubuntu 16.04+, Debian 8+, centos 7")]),s._v(" "),t("p",[s._v("对于使用 "),t("code",[s._v("systemd")]),s._v(" 的系统，请在 "),t("code",[s._v("/etc/docker/daemon.json")]),s._v(" 中写入如下内容（如果文件不存在请新建该文件）")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirror"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub-mirror.c.163.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://mirror.baidubce.com"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.199.100:5000"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：该文件必须符合 "),t("code",[s._v("json")]),s._v(" 规范，否则 Docker 将不能启动。")])]),s._v(" "),t("h2",{attrs:{id:"其他"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),t("p",[s._v("对于 Docker Desktop for Windows 、 Docker Desktop for Mac 在设置中的 "),t("code",[s._v("Docker Engine")]),s._v(" 中进行编辑 ，增加和上边一样的字符串即可。")])])}),[],!1,null,null,null);a.default=n.exports}}]);