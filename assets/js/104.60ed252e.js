(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{774:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"在-travis-ci-中使用-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-travis-ci-中使用-docker"}},[s._v("#")]),s._v(" 在 Travis CI 中使用 Docker")]),s._v(" "),a("p",[s._v("当代码提交到 GitHub 时，"),a("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Travis CI"),a("OutboundLink")],1),s._v(" 会根据项目根目录 "),a("code",[s._v(".travis.yml")]),s._v(" 文件设置的指令，执行一系列操作。")]),s._v(" "),a("p",[s._v("本小节介绍如何在 Travis CI 中使用 Docker 进行持续集成/持续部署（CI/CD）。这里以当代码提交到 GitHub 时自动构建 Docker 镜像并推送到 Docker Hub 为例进行介绍。")]),s._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),a("p",[s._v("首先登录 "),a("a",{attrs:{href:"https://travis-ci.com/account/repositories",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://travis-ci.com/account/repositories"),a("OutboundLink")],1),s._v(" 选择 GitHub 仓库，按照指引安装 GitHub App 来启用 GitHub 仓库构建。")]),s._v(" "),a("p",[s._v("在项目根目录新建一个 "),a("code",[s._v("Dockerfile")]),s._v(" 文件。")]),s._v(" "),a("div",{staticClass:"language-docker line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" alpine\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("新建 Travis CI 配置文件 "),a("code",[s._v(".travis.yml")]),s._v(" 文件。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("language")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bash\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xenial\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录到 docker hub")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "$DOCKER_PASSWORD" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" docker login "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('u "$DOCKER_USERNAME" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("stdin\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里编写测试代码的命令")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(' echo "test code"\n\n'),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("after_success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当代码测试通过后执行的命令")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t username/alpine .\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push username/alpine\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("blockquote",[a("p",[s._v("请提前在 Travis CI 仓库设置页面配置 "),a("code",[s._v("DOCKER_PASSWORD")]),s._v(" "),a("code",[s._v("DOCKER_USERNAME")]),s._v(" 变量")])]),s._v(" "),a("h2",{attrs:{id:"查看结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看结果"}},[s._v("#")]),s._v(" 查看结果")]),s._v(" "),a("p",[s._v("将项目推送到 GitHub，登录 "),a("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Travis CI"),a("OutboundLink")],1),s._v(" 查看构建详情。")])])}),[],!1,null,null,null);t.default=e.exports}}]);