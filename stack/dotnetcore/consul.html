<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>.NET Core ‰ΩøÁî® Consul ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞ | üìñDocuments</title>
    <meta name="generator" content="VuePress 1.9.8">
    <script src="/live2d/L2Dwidget.min.js"></script>
    <script>
            const models = [
                '/live2d/live2d-widget-model-epsilon2_1/assets/Epsilon2.1.model.json',
                '/live2d/live2d-widget-model-haru/01/assets/haru01.model.json',
                '/live2d/live2d-widget-model-haru/02/assets/haru02.model.json',
                '/live2d/live2d-widget-model-haruto/assets/haruto.model.json',
                '/live2d/live2d-widget-model-koharu/assets/koharu.model.json',
                '/live2d/live2d-widget-model-hijiki/assets/hijiki.model.json',
                '/live2d/live2d-widget-model-tororo/assets/tororo.model.json',
                '/live2d/live2d-widget-model-izumi/assets/izumi.model.json',
                '/live2d/live2d-widget-model-miku/assets/miku.model.json',
                '/live2d/live2d-widget-model-shizuku/assets/shizuku.model.json',
                '/live2d/live2d-widget-model-wanko/assets/wanko.model.json',
                '/live2d/live2d-widget-model-z16/assets/z16.model.json'
            ];
            L2Dwidget.init({
                "model": {
                    jsonPath: models[parseInt(Math.random() * (models.length))]
                },
                "display": {
                    "position": "left",
                    "width": 150,
                    "height": 210,
                    "hOffset": 5,
                    "vOffset": 5,
                    "superSample": 1,
                },
                "mobile": {
                    "scale": 1,
                    "show": true,
                    "motion": true,
                },
                "react": {
                    "opacityDefault": .5,
                    "opacityOnHover": .2
                }
            });
        </script>
    <meta name="description" content="This is a personal document library for development work">
    
    <link rel="preload" href="/assets/css/0.styles.aac922ae.css" as="style"><link rel="preload" href="/assets/js/app.b9fe754d.js" as="script"><link rel="preload" href="/assets/js/2.3b8abe35.js" as="script"><link rel="preload" href="/assets/js/6.ce942637.js" as="script"><link rel="prefetch" href="/assets/js/10.b0b05ebc.js"><link rel="prefetch" href="/assets/js/100.b54927e2.js"><link rel="prefetch" href="/assets/js/101.4d3e4363.js"><link rel="prefetch" href="/assets/js/102.59fd7573.js"><link rel="prefetch" href="/assets/js/103.05639da7.js"><link rel="prefetch" href="/assets/js/104.0eca2ead.js"><link rel="prefetch" href="/assets/js/105.e2e8013c.js"><link rel="prefetch" href="/assets/js/106.66d17fbb.js"><link rel="prefetch" href="/assets/js/107.7a1c8203.js"><link rel="prefetch" href="/assets/js/108.4c8b6b05.js"><link rel="prefetch" href="/assets/js/109.53c4109b.js"><link rel="prefetch" href="/assets/js/11.7a062d4f.js"><link rel="prefetch" href="/assets/js/110.2d67f84a.js"><link rel="prefetch" href="/assets/js/111.63ceaba5.js"><link rel="prefetch" href="/assets/js/112.8d323a52.js"><link rel="prefetch" href="/assets/js/113.89375778.js"><link rel="prefetch" href="/assets/js/114.848e1726.js"><link rel="prefetch" href="/assets/js/115.76b606a6.js"><link rel="prefetch" href="/assets/js/116.d760f1fd.js"><link rel="prefetch" href="/assets/js/117.4a6287fb.js"><link rel="prefetch" href="/assets/js/118.00bce74a.js"><link rel="prefetch" href="/assets/js/119.30fcf9a7.js"><link rel="prefetch" href="/assets/js/12.6e0f6805.js"><link rel="prefetch" href="/assets/js/120.415bd306.js"><link rel="prefetch" href="/assets/js/121.d481b5e0.js"><link rel="prefetch" href="/assets/js/122.c41dd213.js"><link rel="prefetch" href="/assets/js/123.7d0f5309.js"><link rel="prefetch" href="/assets/js/124.5e12ff91.js"><link rel="prefetch" href="/assets/js/125.6a81c0d4.js"><link rel="prefetch" href="/assets/js/126.c3beadeb.js"><link rel="prefetch" href="/assets/js/127.ed6ab5f4.js"><link rel="prefetch" href="/assets/js/128.0f3c6540.js"><link rel="prefetch" href="/assets/js/129.fe58aeb0.js"><link rel="prefetch" href="/assets/js/13.6724f077.js"><link rel="prefetch" href="/assets/js/130.175ee594.js"><link rel="prefetch" href="/assets/js/131.98075a1f.js"><link rel="prefetch" href="/assets/js/132.d7654ec6.js"><link rel="prefetch" href="/assets/js/133.1d88831b.js"><link rel="prefetch" href="/assets/js/134.eb563b3b.js"><link rel="prefetch" href="/assets/js/135.85504297.js"><link rel="prefetch" href="/assets/js/136.5689fb69.js"><link rel="prefetch" href="/assets/js/137.73f22858.js"><link rel="prefetch" href="/assets/js/138.0b456491.js"><link rel="prefetch" href="/assets/js/139.85571fc1.js"><link rel="prefetch" href="/assets/js/14.fcba80ec.js"><link rel="prefetch" href="/assets/js/140.95dda9bf.js"><link rel="prefetch" href="/assets/js/141.ef7c145a.js"><link rel="prefetch" href="/assets/js/142.b3f4919d.js"><link rel="prefetch" href="/assets/js/143.b16792a4.js"><link rel="prefetch" href="/assets/js/144.258f7625.js"><link rel="prefetch" href="/assets/js/145.3ff62268.js"><link rel="prefetch" href="/assets/js/146.fee2b8e1.js"><link rel="prefetch" href="/assets/js/147.b065a7be.js"><link rel="prefetch" href="/assets/js/148.fcf38174.js"><link rel="prefetch" href="/assets/js/149.6d6990c2.js"><link rel="prefetch" href="/assets/js/15.a948398c.js"><link rel="prefetch" href="/assets/js/150.73134f14.js"><link rel="prefetch" href="/assets/js/151.c323fee5.js"><link rel="prefetch" href="/assets/js/152.819d2f82.js"><link rel="prefetch" href="/assets/js/153.b383232a.js"><link rel="prefetch" href="/assets/js/154.f09b8fd6.js"><link rel="prefetch" href="/assets/js/155.119d6f84.js"><link rel="prefetch" href="/assets/js/156.22272b51.js"><link rel="prefetch" href="/assets/js/157.8a9c2158.js"><link rel="prefetch" href="/assets/js/158.12cc7036.js"><link rel="prefetch" href="/assets/js/159.9011135c.js"><link rel="prefetch" href="/assets/js/16.1a3290d4.js"><link rel="prefetch" href="/assets/js/160.29392b37.js"><link rel="prefetch" href="/assets/js/161.2b9f4774.js"><link rel="prefetch" href="/assets/js/162.f2afcca8.js"><link rel="prefetch" href="/assets/js/163.1d03d1e6.js"><link rel="prefetch" href="/assets/js/164.836b7e04.js"><link rel="prefetch" href="/assets/js/165.798d4e49.js"><link rel="prefetch" href="/assets/js/166.1018cf55.js"><link rel="prefetch" href="/assets/js/167.a5ef6ef1.js"><link rel="prefetch" href="/assets/js/168.66ee1f27.js"><link rel="prefetch" href="/assets/js/169.46a95e98.js"><link rel="prefetch" href="/assets/js/17.3c3d6db1.js"><link rel="prefetch" href="/assets/js/170.4860234f.js"><link rel="prefetch" href="/assets/js/171.37f76746.js"><link rel="prefetch" href="/assets/js/172.73abe90f.js"><link rel="prefetch" href="/assets/js/173.9a286c45.js"><link rel="prefetch" href="/assets/js/174.8632fc84.js"><link rel="prefetch" href="/assets/js/175.59f3a0e8.js"><link rel="prefetch" href="/assets/js/176.a3b321f1.js"><link rel="prefetch" href="/assets/js/177.6cb7be2d.js"><link rel="prefetch" href="/assets/js/178.201dfeb7.js"><link rel="prefetch" href="/assets/js/179.89fb48b2.js"><link rel="prefetch" href="/assets/js/18.7699f70c.js"><link rel="prefetch" href="/assets/js/180.2207c30b.js"><link rel="prefetch" href="/assets/js/181.97ba6830.js"><link rel="prefetch" href="/assets/js/182.c86e245f.js"><link rel="prefetch" href="/assets/js/183.475a5b4c.js"><link rel="prefetch" href="/assets/js/184.7a2ae4eb.js"><link rel="prefetch" href="/assets/js/185.6ae4ab7d.js"><link rel="prefetch" href="/assets/js/186.6d8ca603.js"><link rel="prefetch" href="/assets/js/187.b4f75fc6.js"><link rel="prefetch" href="/assets/js/188.aa21589a.js"><link rel="prefetch" href="/assets/js/189.f47edb27.js"><link rel="prefetch" href="/assets/js/19.165c07cc.js"><link rel="prefetch" href="/assets/js/190.9f6f8cb3.js"><link rel="prefetch" href="/assets/js/191.79b9c821.js"><link rel="prefetch" href="/assets/js/192.bccfd69a.js"><link rel="prefetch" href="/assets/js/193.8b308bdd.js"><link rel="prefetch" href="/assets/js/194.91b537c7.js"><link rel="prefetch" href="/assets/js/195.f7012298.js"><link rel="prefetch" href="/assets/js/196.6ed77506.js"><link rel="prefetch" href="/assets/js/197.0a8b3a41.js"><link rel="prefetch" href="/assets/js/198.a4206c8e.js"><link rel="prefetch" href="/assets/js/199.00793e56.js"><link rel="prefetch" href="/assets/js/20.73239862.js"><link rel="prefetch" href="/assets/js/200.73ce4e83.js"><link rel="prefetch" href="/assets/js/201.f73a7320.js"><link rel="prefetch" href="/assets/js/202.d43a0ecf.js"><link rel="prefetch" href="/assets/js/203.4b9017d7.js"><link rel="prefetch" href="/assets/js/204.cf48e1c4.js"><link rel="prefetch" href="/assets/js/205.28628011.js"><link rel="prefetch" href="/assets/js/206.5920336b.js"><link rel="prefetch" href="/assets/js/207.808d60f7.js"><link rel="prefetch" href="/assets/js/208.b29200fe.js"><link rel="prefetch" href="/assets/js/209.982379e3.js"><link rel="prefetch" href="/assets/js/21.049ec097.js"><link rel="prefetch" href="/assets/js/210.b8d014f4.js"><link rel="prefetch" href="/assets/js/211.db0b3b01.js"><link rel="prefetch" href="/assets/js/212.558ea567.js"><link rel="prefetch" href="/assets/js/213.e0f6808a.js"><link rel="prefetch" href="/assets/js/214.fba997fb.js"><link rel="prefetch" href="/assets/js/215.183e356d.js"><link rel="prefetch" href="/assets/js/216.ee60ed0d.js"><link rel="prefetch" href="/assets/js/217.681965c2.js"><link rel="prefetch" href="/assets/js/218.123f7113.js"><link rel="prefetch" href="/assets/js/219.ec67c6f9.js"><link rel="prefetch" href="/assets/js/22.a0806800.js"><link rel="prefetch" href="/assets/js/220.171cebcd.js"><link rel="prefetch" href="/assets/js/221.d48bb1cc.js"><link rel="prefetch" href="/assets/js/222.8bb5abd4.js"><link rel="prefetch" href="/assets/js/223.a24949b0.js"><link rel="prefetch" href="/assets/js/224.35b4de93.js"><link rel="prefetch" href="/assets/js/225.c231055d.js"><link rel="prefetch" href="/assets/js/226.8a45be79.js"><link rel="prefetch" href="/assets/js/227.5e0e539f.js"><link rel="prefetch" href="/assets/js/228.d93ebf4c.js"><link rel="prefetch" href="/assets/js/229.4c4af297.js"><link rel="prefetch" href="/assets/js/23.e74342a2.js"><link rel="prefetch" href="/assets/js/230.6df94ed0.js"><link rel="prefetch" href="/assets/js/231.48eea318.js"><link rel="prefetch" href="/assets/js/232.12f494ec.js"><link rel="prefetch" href="/assets/js/233.1d240b5a.js"><link rel="prefetch" href="/assets/js/234.d535fcc9.js"><link rel="prefetch" href="/assets/js/235.6df6ae62.js"><link rel="prefetch" href="/assets/js/236.ca5cb6eb.js"><link rel="prefetch" href="/assets/js/237.4e91595b.js"><link rel="prefetch" href="/assets/js/238.e162e9f7.js"><link rel="prefetch" href="/assets/js/239.e1c3977f.js"><link rel="prefetch" href="/assets/js/24.44ad4c5c.js"><link rel="prefetch" href="/assets/js/240.42dd5e45.js"><link rel="prefetch" href="/assets/js/241.22d42fd6.js"><link rel="prefetch" href="/assets/js/242.24587dfa.js"><link rel="prefetch" href="/assets/js/243.0623bced.js"><link rel="prefetch" href="/assets/js/244.d55249cd.js"><link rel="prefetch" href="/assets/js/245.2fa7796f.js"><link rel="prefetch" href="/assets/js/246.f78eb7e8.js"><link rel="prefetch" href="/assets/js/247.6bc45375.js"><link rel="prefetch" href="/assets/js/248.041d11f6.js"><link rel="prefetch" href="/assets/js/249.0e2fd615.js"><link rel="prefetch" href="/assets/js/25.a645b353.js"><link rel="prefetch" href="/assets/js/250.9d740c87.js"><link rel="prefetch" href="/assets/js/251.35cdfeb3.js"><link rel="prefetch" href="/assets/js/26.de045c15.js"><link rel="prefetch" href="/assets/js/27.2f21a726.js"><link rel="prefetch" href="/assets/js/28.1ca4ea1c.js"><link rel="prefetch" href="/assets/js/29.a820836b.js"><link rel="prefetch" href="/assets/js/3.cf13954c.js"><link rel="prefetch" href="/assets/js/30.8483a724.js"><link rel="prefetch" href="/assets/js/31.585f166c.js"><link rel="prefetch" href="/assets/js/32.57ee975a.js"><link rel="prefetch" href="/assets/js/33.e2a96278.js"><link rel="prefetch" href="/assets/js/34.e71de565.js"><link rel="prefetch" href="/assets/js/35.929cad59.js"><link rel="prefetch" href="/assets/js/36.589650d2.js"><link rel="prefetch" href="/assets/js/37.ae130546.js"><link rel="prefetch" href="/assets/js/38.8cda10ee.js"><link rel="prefetch" href="/assets/js/39.ebf5a9ac.js"><link rel="prefetch" href="/assets/js/4.c74193d9.js"><link rel="prefetch" href="/assets/js/40.e7f77bb6.js"><link rel="prefetch" href="/assets/js/41.86b6dc4f.js"><link rel="prefetch" href="/assets/js/42.d156b307.js"><link rel="prefetch" href="/assets/js/43.a93f9438.js"><link rel="prefetch" href="/assets/js/44.39e2d23b.js"><link rel="prefetch" href="/assets/js/45.5105d94f.js"><link rel="prefetch" href="/assets/js/46.60a11810.js"><link rel="prefetch" href="/assets/js/47.cb9acb37.js"><link rel="prefetch" href="/assets/js/48.4697343a.js"><link rel="prefetch" href="/assets/js/49.46a333d3.js"><link rel="prefetch" href="/assets/js/5.853ac351.js"><link rel="prefetch" href="/assets/js/50.8d2db9e4.js"><link rel="prefetch" href="/assets/js/51.ea163da4.js"><link rel="prefetch" href="/assets/js/52.c52e8748.js"><link rel="prefetch" href="/assets/js/53.8ec832df.js"><link rel="prefetch" href="/assets/js/54.3803456b.js"><link rel="prefetch" href="/assets/js/55.3c150003.js"><link rel="prefetch" href="/assets/js/56.ffa5f676.js"><link rel="prefetch" href="/assets/js/57.26322200.js"><link rel="prefetch" href="/assets/js/58.cd085807.js"><link rel="prefetch" href="/assets/js/59.f48efe48.js"><link rel="prefetch" href="/assets/js/60.43dc14e9.js"><link rel="prefetch" href="/assets/js/61.4e62d242.js"><link rel="prefetch" href="/assets/js/62.13c228af.js"><link rel="prefetch" href="/assets/js/63.7d923fbf.js"><link rel="prefetch" href="/assets/js/64.4729058e.js"><link rel="prefetch" href="/assets/js/65.024bb0ce.js"><link rel="prefetch" href="/assets/js/66.9e676354.js"><link rel="prefetch" href="/assets/js/67.3797c980.js"><link rel="prefetch" href="/assets/js/68.e2176d44.js"><link rel="prefetch" href="/assets/js/69.6e53bc1a.js"><link rel="prefetch" href="/assets/js/7.c406ab2a.js"><link rel="prefetch" href="/assets/js/70.b69727a3.js"><link rel="prefetch" href="/assets/js/71.e3d674a5.js"><link rel="prefetch" href="/assets/js/72.52b3f369.js"><link rel="prefetch" href="/assets/js/73.31325192.js"><link rel="prefetch" href="/assets/js/74.85e95540.js"><link rel="prefetch" href="/assets/js/75.1adf7d85.js"><link rel="prefetch" href="/assets/js/76.21834427.js"><link rel="prefetch" href="/assets/js/77.87cca736.js"><link rel="prefetch" href="/assets/js/78.239b0cff.js"><link rel="prefetch" href="/assets/js/79.a6200e2b.js"><link rel="prefetch" href="/assets/js/8.5795575d.js"><link rel="prefetch" href="/assets/js/80.03e0e3c0.js"><link rel="prefetch" href="/assets/js/81.ad80ef05.js"><link rel="prefetch" href="/assets/js/82.b0e77016.js"><link rel="prefetch" href="/assets/js/83.dc5da3aa.js"><link rel="prefetch" href="/assets/js/84.df4f8664.js"><link rel="prefetch" href="/assets/js/85.1239bd2a.js"><link rel="prefetch" href="/assets/js/86.45f5b58a.js"><link rel="prefetch" href="/assets/js/87.b2ca9750.js"><link rel="prefetch" href="/assets/js/88.90b5b2b9.js"><link rel="prefetch" href="/assets/js/89.ebed8c44.js"><link rel="prefetch" href="/assets/js/9.ea172e9e.js"><link rel="prefetch" href="/assets/js/90.a1ab5b15.js"><link rel="prefetch" href="/assets/js/91.55988ca3.js"><link rel="prefetch" href="/assets/js/92.a011305d.js"><link rel="prefetch" href="/assets/js/93.115ceaca.js"><link rel="prefetch" href="/assets/js/94.1f10beee.js"><link rel="prefetch" href="/assets/js/95.d349f826.js"><link rel="prefetch" href="/assets/js/96.c4fe03a1.js"><link rel="prefetch" href="/assets/js/97.1547e81b.js"><link rel="prefetch" href="/assets/js/98.70bfb14e.js"><link rel="prefetch" href="/assets/js/99.b32787f9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aac922ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">üìñDocuments</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="‚ö°Á≥ªÂàóÊñáÁ´†" class="dropdown-title"><span class="title">‚ö°Á≥ªÂàóÊñáÁ´†</span> <span class="arrow down"></span></button> <button type="button" aria-label="‚ö°Á≥ªÂàóÊñáÁ´†" class="mobile-dropdown-title"><span class="title">‚ö°Á≥ªÂàóÊñáÁ´†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  üöÄÂü∫‰∫é abp vNext Âíå .NET Core ÂºÄÂèëÂçöÂÆ¢È°πÁõÆ
</a></li></ul></div></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  üç∫ÊäÄÊúØÊ†à
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  üéâÊÄªÁªì
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="üëçÈòøÊòüPlus" class="dropdown-title"><span class="title">üëçÈòøÊòüPlus</span> <span class="arrow down"></span></button> <button type="button" aria-label="üëçÈòøÊòüPlus" class="mobile-dropdown-title"><span class="title">üëçÈòøÊòüPlus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/meowv/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlus - ÂçöÂÆ¢Âõ≠
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/3122268756261864" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlus - ÊéòÈáë
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/Tencentgou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlusÁöÑÂæÆÂçö
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    ‚≠êÔ∏èGitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="‚ö°Á≥ªÂàóÊñáÁ´†" class="dropdown-title"><span class="title">‚ö°Á≥ªÂàóÊñáÁ´†</span> <span class="arrow down"></span></button> <button type="button" aria-label="‚ö°Á≥ªÂàóÊñáÁ´†" class="mobile-dropdown-title"><span class="title">‚ö°Á≥ªÂàóÊñáÁ´†</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/aspnetcore/abp-blog/" class="nav-link">
  üöÄÂü∫‰∫é abp vNext Âíå .NET Core ÂºÄÂèëÂçöÂÆ¢È°πÁõÆ
</a></li></ul></div></div><div class="nav-item"><a href="/stack/" class="nav-link router-link-active">
  üç∫ÊäÄÊúØÊ†à
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  üéâÊÄªÁªì
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="üëçÈòøÊòüPlus" class="dropdown-title"><span class="title">üëçÈòøÊòüPlus</span> <span class="arrow down"></span></button> <button type="button" aria-label="üëçÈòøÊòüPlus" class="mobile-dropdown-title"><span class="title">üëçÈòøÊòüPlus</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://meowv.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  meowv.com
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/meowv/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlus - ÂçöÂÆ¢Âõ≠
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.im/user/3122268756261864" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlus - ÊéòÈáë
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://weibo.com/Tencentgou/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ÈòøÊòüPlusÁöÑÂæÆÂçö
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/meowv/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    ‚≠êÔ∏èGitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>.NET Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/stack/dotnetcore/abp-template.html" class="sidebar-link">Âü∫‰∫é abp vNext ÁöÑÂø´ÈÄüÂºÄÂèëÊ®°Êùø</a></li><li><a href="/stack/dotnetcore/autoapi.html" class="sidebar-link">Âä®ÊÄÅ Restful API ÁîüÊàê</a></li><li><a href="/stack/dotnetcore/import-and-export-excel.html" class="sidebar-link">.NET Core ‰∏≠ÂØºÂÖ•ÂØºÂá∫Excel</a></li><li><a href="/stack/dotnetcore/captcha.html" class="sidebar-link">.NET Core ‰∏≠ÁîüÊàêÈ™åËØÅÁ†Å</a></li><li><a href="/stack/dotnetcore/mailkit.html" class="sidebar-link">.NET Core ‰∏ãÊî∂ÂèëÈÇÆ‰ª∂‰πã MailKit</a></li><li><a href="/stack/dotnetcore/qrcode.html" class="sidebar-link">.NET Core ÁîüÊàê‰∫åÁª¥Á†Å</a></li><li><a href="/stack/dotnetcore/swagger.html" class="sidebar-link">.NET Core APIÊñáÊ°£ÁÆ°ÁêÜÁªÑ‰ª∂ Swagger</a></li><li><a href="/stack/dotnetcore/json-web-token.html" class="sidebar-link">.NET Core ÈõÜÊàêJWTËÆ§ËØÅ</a></li><li><a href="/stack/dotnetcore/spider.html" class="sidebar-link">.NET Core ‰∏ãÁöÑÁà¨Ëô´Âà©Âô®</a></li><li><a href="/stack/dotnetcore/apollo-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® Apollo ÈÖçÁΩÆ‰∏≠ÂøÉ</a></li><li><a href="/stack/dotnetcore/grpc-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® gRPC</a></li><li><a href="/stack/dotnetcore/elasticsearch-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® ElasticSearch</a></li><li><a href="/stack/dotnetcore/rabbitmq-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® RabbitMQ</a></li><li><a href="/stack/dotnetcore/kafka-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® Kafka</a></li><li><a href="/stack/dotnetcore/log4net-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® Log4Net ËÆ∞ÂΩïÊó•Âøó</a></li><li><a href="/stack/dotnetcore/nlog-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® NLog ËÆ∞ÂΩïÊó•Âøó</a></li><li><a href="/stack/dotnetcore/serilog-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® Serilog ËÆ∞ÂΩïÊó•Âøó</a></li><li><a href="/stack/dotnetcore/exceptionless-in-dotnet.html" class="sidebar-link">.NET Core ‰∏ã‰ΩøÁî® Exceptionless ËÆ∞ÂΩïÊó•Âøó</a></li><li><a href="/stack/dotnetcore/consul.html" aria-current="page" class="active sidebar-link">.NET Core ‰ΩøÁî® Consul ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#ÂÆâË£Ö" class="sidebar-link">ÂÆâË£Ö</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#Âø´ÈÄü‰ΩøÁî®" class="sidebar-link">Âø´ÈÄü‰ΩøÁî®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#ÊúçÂä°Ê≥®ÂÜå" class="sidebar-link">ÊúçÂä°Ê≥®ÂÜå</a></li><li class="sidebar-sub-header"><a href="/stack/dotnetcore/consul.html#ÊúçÂä°ÂèëÁé∞" class="sidebar-link">ÊúçÂä°ÂèëÁé∞</a></li></ul></li></ul></li><li><a href="/stack/dotnetcore/api-gateway.html" class="sidebar-link">.NET Core ‰∏ãÁöÑ API ÁΩëÂÖ≥</a></li><li><a href="/stack/dotnetcore/mta-package.html" class="sidebar-link">‰ΩøÁî®MTA HTML5ÁªüËÆ°APIÊù•ÂàÜÊûêÊï∞ÊçÆ</a></li><li><a href="/stack/dotnetcore/operate-git-auto-publish-to-github.html" class="sidebar-link">.NET Core ‰∏ãÊìç‰Ωú GitÔºåËá™Âä®Êèê‰∫§‰ª£Á†ÅÂà∞ GitHub</a></li><li><a href="/stack/dotnetcore/epplus-wps-error.html" class="sidebar-link">EPPlus.Core Â§ÑÁêÜ Excel Êä•Èîô‰πãÂ§©Âùë WPS</a></li><li><a href="/stack/dotnetcore/publish-to-centos.html" class="sidebar-link">Âü∫‰∫é.NET CoreÂºÄÂèëÁöÑ‰∏™‰∫∫ÂçöÂÆ¢ ÂèëÂ∏ÉËá≥CentOSÂ∞èËÆ°</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blazor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Planning Analytics</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="net-core-‰ΩøÁî®-consul-ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞"><a href="#net-core-‰ΩøÁî®-consul-ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞" class="header-anchor">#</a> .NET Core ‰ΩøÁî® Consul ÊúçÂä°Ê≥®ÂÜåÂèëÁé∞</h1> <p><code>Consul</code>ÊòØ‰∏Ä‰∏™Áî®Êù•ÂÆûÁé∞ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊúçÂä°ÂèëÁé∞‰∏éÈÖçÁΩÆÁöÑÂºÄÊ∫êÂ∑•ÂÖ∑„ÄÇÂÆÉÂÜÖÁΩÆ‰∫ÜÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞Ê°ÜÊû∂„ÄÅÂàÜÂ∏É‰∏ÄËá¥ÊÄßÂçèËÆÆÂÆûÁé∞„ÄÅÂÅ•Â∫∑Ê£ÄÊü•„ÄÅKey/ValueÂ≠òÂÇ®„ÄÅÂ§öÊï∞ÊçÆ‰∏≠ÂøÉÊñπÊ°àÔºå‰∏çÂÜçÈúÄË¶Å‰æùËµñÂÖ∂‰ªñÂ∑•ÂÖ∑Ôºå‰ΩøÁî®Ëµ∑Êù•‰πüËæÉ‰∏∫ÁÆÄÂçï„ÄÇ</p> <ul><li><code>Consul</code>ÂÆòÁΩëÔºö<a href="https://www.consul.io" target="_blank" rel="noopener noreferrer">https://www.consul.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>ÂºÄÊ∫êÂú∞ÂùÄÔºö<a href="https://github.com/hashicorp/consul" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/consul<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>„ÄÅ<a href="https://github.com/G-Research/consuldotnet" target="_blank" rel="noopener noreferrer">https://github.com/G-Research/consuldotnet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="ÂÆâË£Ö"><a href="#ÂÆâË£Ö" class="header-anchor">#</a> ÂÆâË£Ö</h2> <p><code>Consul</code>ÊîØÊåÅÂêÑÁßçÂπ≥Âè∞ÁöÑÂÆâË£ÖÔºåÂÆâË£ÖÊñáÊ°£Ôºö<a href="https://www.consul.io/downloads" target="_blank" rel="noopener noreferrer">https://www.consul.io/downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>Ôºå‰∏∫‰∫ÜÂø´ÈÄü‰ΩøÁî®ÔºåÊàëËøôÈáåÈÄâÊã©Áî®<a href="/stack/docker/repo/consul.html">dockerÊñπÂºèÂÆâË£Ö</a>„ÄÇ</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">service_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>bootstrap<span class="token punctuation">-</span>expect=3 <span class="token punctuation">-</span>node=service_1
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_1<span class="token punctuation">:</span>/data
  <span class="token key atrule">service_2</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>node=service_2
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_2<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_1
  <span class="token key atrule">service_3</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>server <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>node=service_3
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/service_3<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_1
  <span class="token key atrule">client_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> consul
    <span class="token key atrule">command</span><span class="token punctuation">:</span> agent <span class="token punctuation">-</span>client=0.0.0.0 <span class="token punctuation">-</span>retry<span class="token punctuation">-</span>join=service_1 <span class="token punctuation">-</span>ui <span class="token punctuation">-</span>node=client_1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8500<span class="token punctuation">:</span><span class="token number">8500</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/consul/data/client_1<span class="token punctuation">:</span>/data
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_2
      <span class="token punctuation">-</span> service_3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Êèê‰æõ‰∏Ä‰∏™<code>docker-compose.yaml</code>Ôºå‰ΩøÁî®<code>docker-compose up</code>ÁºñÊéíËÑöÊú¨ÂêØÂä®<code>Consul</code>ÔºåÂ¶ÇÊûú‰Ω†‰∏çÁÜüÊÇâÔºåÂèØ‰ª•ÈÄâÊã©ÂÖ∂ÂÆÉÊñπÂºèËÉΩËøêË°å<code>Consul</code>Âç≥ÂèØ„ÄÇ</p> <p><img src="/assets/img/consul-01.c68f91f8.png" alt=" "></p> <p>ËøôÈáå‰ΩøÁî® Docker Êê≠Âª∫ 3‰∏™ server ËäÇÁÇπ + 1 ‰∏™ client ËäÇÁÇπÔºåAPI ÊúçÂä°ÈÄöËøá client ËäÇÁÇπËøõË°åÊúçÂä°Ê≥®ÂÜåÂíåÂèëÁé∞„ÄÇ</p> <p>ÂÆâË£ÖÂÆåÊàêÂêØÂä®<code>Consul</code>ÔºåÊâìÂºÄÈªòËÆ§Âú∞ÂùÄ <a href="http://localhost:8500" target="_blank" rel="noopener noreferrer">http://localhost:8500<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ÂèØ‰ª•ÁúãÂà∞<code>Consul</code>uiÁïåÈù¢„ÄÇ</p> <p><img src="/assets/img/consul-02.92c417cc.png" alt=" "></p> <h2 id="Âø´ÈÄü‰ΩøÁî®"><a href="#Âø´ÈÄü‰ΩøÁî®" class="header-anchor">#</a> Âø´ÈÄü‰ΩøÁî®</h2> <p>Ê∑ªÂä†‰∏§‰∏™webapiÊúçÂä°ÔºåServiceAÂíåServiceBÔºå‰∏Ä‰∏™webapiÂÆ¢Êà∑Á´ØClientÊù•Ë∞ÉÁî®ÊúçÂä°„ÄÇ</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>dotnet new sln <span class="token parameter variable">-n</span> consul_demo

dotnet new webapi <span class="token parameter variable">-n</span> ServiceA
dotnet sln <span class="token function">add</span> ServiceA/ServiceA.csproj

dotnet new webapi <span class="token parameter variable">-n</span> ServiceB
dotnet sln <span class="token function">add</span> ServiceB/ServiceB.csproj

dotnet new webapi <span class="token parameter variable">-n</span> Client
dotnet sln <span class="token function">add</span> Client/Client.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/assets/img/consul-03.27b4a26b.png" alt=" "></p> <p>Âú®È°πÁõÆ‰∏≠Ê∑ªÂä†<code>Consul</code>ÁªÑ‰ª∂ÂåÖ</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code><span class="token function">Install-Package</span> Consul
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ÊúçÂä°Ê≥®ÂÜå"><a href="#ÊúçÂä°Ê≥®ÂÜå" class="header-anchor">#</a> ÊúçÂä°Ê≥®ÂÜå</h3> <p>Êé•‰∏ãÊù•Âú®‰∏§‰∏™ÊúçÂä°‰∏≠Ê∑ªÂä†ÂøÖË¶ÅÁöÑ‰ª£Á†ÅÊù•ÂÆûÁé∞Â∞ÜÊúçÂä°Ê≥®ÂÜåÂà∞<code>Consul</code>‰∏≠„ÄÇ</p> <p>È¶ñÂÖàÂ∞Ü<code>Consul</code>ÈÖçÁΩÆ‰ø°ÊÅØÊ∑ªÂä†Âà∞<code>appsettings.json</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Consul&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://host.docker.internal:8500&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;HealthCheck&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/healthcheck&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;host.docker.internal&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Âõ†‰∏∫Êàë‰ª¨Ë¶ÅÂ∞ÜÈ°πÁõÆÈÉΩËøêË°åÂú®docker‰∏≠ÔºåÊâÄ‰ª•ËøôÈáåÁöÑÂú∞ÂùÄË¶ÅÁî® host.docker.internal ‰ª£ÊõøÔºå‰ΩøÁî® localhost Êó†Ê≥ïÊ≠£Â∏∏ÂêØÂä®ÔºåÂ¶ÇÊûú‰∏çÂú® docker ‰∏≠ËøêË°åÔºåËøôÈáåÂ∞±ÈÖçÁΩÆÂ±Ç localhost„ÄÇ</p> <p>Ê∑ªÂä†‰∏Ä‰∏™Êâ©Â±ïÊñπÊ≥ï<code>UseConul(this IApplicationBuilder app, IConfiguration configuration, IHostApplicationLifetime lifetime)</code>„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Consul</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Extensions</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IApplicationBuilder</span> <span class="token function">UseConul</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">IHostApplicationLifetime</span> lifetime<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsulClient</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Address&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ConsulÂÆ¢Êà∑Á´ØÂú∞ÂùÄ</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AgentServiceRegistration</span>
            <span class="token punctuation">{</span>
                ID <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ÂîØ‰∏ÄId</span>
                Name <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ÊúçÂä°Âêç</span>
                Address <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Ip&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ÊúçÂä°ÁªëÂÆöIP</span>
                Port <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ÊúçÂä°ÁªëÂÆöÁ´ØÂè£</span>
                Check <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AgentServiceCheck</span>
                <span class="token punctuation">{</span>
                    DeregisterCriticalServiceAfter <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ÊúçÂä°ÂêØÂä®Â§ö‰πÖÂêéÊ≥®ÂÜå</span>
                    Interval <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ÂÅ•Â∫∑Ê£ÄÊü•Êó∂Èó¥Èó¥Èöî</span>
                    HTTP <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Ip&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:HealthCheck&quot;</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> <span class="token comment">// ÂÅ•Â∫∑Ê£ÄÊü•Âú∞ÂùÄ</span>
                    Timeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// Ë∂ÖÊó∂Êó∂Èó¥</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token comment">// Ê≥®ÂÜåÊúçÂä°</span>
            client<span class="token punctuation">.</span>Agent<span class="token punctuation">.</span><span class="token function">ServiceRegister</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Â∫îÁî®Á®ãÂ∫èÁªàÊ≠¢Êó∂ÔºåÂèñÊ∂àÊúçÂä°Ê≥®ÂÜå</span>
            lifetime<span class="token punctuation">.</span>ApplicationStopping<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                client<span class="token punctuation">.</span>Agent<span class="token punctuation">.</span><span class="token function">ServiceDeregister</span><span class="token punctuation">(</span>registration<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> app<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>ÁÑ∂ÂêéÂú®<code>Startup.cs</code>‰∏≠‰ΩøÁî®Êâ©Â±ïÊñπÊ≥ïÂç≥ÂèØ„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">IHostApplicationLifetime</span> lifetime<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    app<span class="token punctuation">.</span><span class="token function">UseConul</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">,</span> lifetime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Ê≥®ÊÑèÔºåËøôÈáåÂ∞Ü<code>IConfiguration</code>Âíå<code>IHostApplicationLifetime</code>‰Ωú‰∏∫ÂèÇÊï∞‰º†ËøõÊù•ÁöÑÔºåÊ†πÊçÆÂÆûÈôÖÂºÄÂèëÂÅöÂØπÂ∫îÁöÑ‰øÆÊîπÂ∞±ÂèØ‰ª•‰∫Ü„ÄÇ</p> <p>ÂàÜÂà´Âú®ServiceAÂíåServiceBÈÉΩÂÆåÊàê‰∏ÄÈÅç‰∏äËø∞Êìç‰ΩúÔºåÂõ†‰∏∫‰∏çÊòØÂÆûÈôÖÈ°πÁõÆÔºåËøôÈáåÂ∞±‰∫ßÁîüÁöÑËÆ∏Â§öÈáçÂ§ç‰ª£Á†ÅÔºåÂú®ÁúüÊ≠£ÁöÑÈ°πÁõÆÂºÄÂèëËøáÁ®ã‰∏≠ÂèØ‰ª•ËÄÉËôëÊîæÂú®‰∏Ä‰∏™ÂçïÁã¨ÁöÑÈ°πÁõÆ‰∏≠ÔºåServiceAÂíåServiceBÂàÜÂà´ÂºïÁî®ÔºåË∞ÉÁî®„ÄÇ</p> <p>Êé•ÁùÄÂéªÂÆûÁé∞ÂÅ•Â∫∑Ê£ÄÊü•Êé•Âè£„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceA</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthCheckController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// ÂÅ•Â∫∑Ê£ÄÊü•</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceB</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceB<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthCheckController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// ÂÅ•Â∫∑Ê£ÄÊü•</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ÊúÄÂêéÂú®ServiceAÂíåServiceB‰∏≠ÈÉΩÊ∑ªÂä†‰∏Ä‰∏™Êé•Âè£„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceA</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceA<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceAController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;ÊàëÊòØ</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>ServiceA<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">ÔºåÂΩìÂâçÊó∂Èó¥Ôºö</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token format-string"><span class="token punctuation">:</span>G</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
                ip <span class="token operator">=</span> Request<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Connection<span class="token punctuation">.</span>LocalIpAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                port <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ServiceB</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ServiceB<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceBController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                msg <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;ÊàëÊòØ</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>ServiceB<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">ÔºåÂΩìÂâçÊó∂Èó¥Ôºö</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now</span><span class="token format-string"><span class="token punctuation">:</span>G</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span>
                ip <span class="token operator">=</span> Request<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Connection<span class="token punctuation">.</span>LocalIpAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                port <span class="token operator">=</span> configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Port&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>ËøôÊ†∑Êàë‰ª¨ÂÜô‰∫Ü‰∏§‰∏™ÊúçÂä°ÔºåServiceAÂíåServiceB„ÄÇÈÉΩÊ∑ªÂä†‰∫ÜÂÅ•Â∫∑Ê£ÄÊü•Êé•Âè£Âíå‰∏Ä‰∏™Ëá™Â∑±ÁöÑÊúçÂä°Êé•Âè£ÔºåËøîÂõû‰∏ÄÊÆµjson„ÄÇ</p> <p>Êàë‰ª¨Áé∞Âú®Êù•ËøêË°åÁúãÁúãÊïàÊûúÔºåÂèØ‰ª•‰ΩøÁî®‰ªª‰ΩïÊñπÂºèÔºåÂè™Ë¶ÅËÉΩÂêØÂä®Âç≥ÂèØÔºåÊàëËøôÈáåÈÄâÊã©Âú®docker‰∏≠ËøêË°åÔºåÁõ¥Êé•Âú® Visual Studio‰∏≠ÂØπÁùÄ‰∏§‰∏™Ëß£ÂÜ≥ÊñπÊ°àÂè≥ÈîÆÊ∑ªÂä†ÔºåÈÄâÊã©DockerÊîØÊåÅÔºåÈªòËÆ§‰ºöÂ∏ÆÊàë‰ª¨Ëá™Âä®ÂàõÂª∫Â•ΩDockfileÔºåÈùûÂ∏∏Êñπ‰æø„ÄÇ</p> <p>ÁîüÊàêÁöÑDockfileÊñá‰ª∂ÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># ServiceA</span>
<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim <span class="token keyword">AS</span> base</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 443</span>

<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk:3.1-buster <span class="token keyword">AS</span> build</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /src</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;ServiceA/ServiceA.csproj&quot;</span>, <span class="token string">&quot;ServiceA/&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;ServiceA/ServiceA.csproj&quot;</span></span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/ServiceA&quot;</span></span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;ServiceA.csproj&quot;</span> -c Release -o /app/build</span>

<span class="token instruction"><span class="token keyword">FROM</span> build <span class="token keyword">AS</span> publish</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;ServiceA.csproj&quot;</span> -c Release -o /app/publish</span>

<span class="token instruction"><span class="token keyword">FROM</span> base <span class="token keyword">AS</span> final</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">publish</span></span> /app/publish .</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;dotnet&quot;</span>, <span class="token string">&quot;ServiceA.dll&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># ServiceB</span>
<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet:3.1-buster-slim <span class="token keyword">AS</span> base</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 443</span>

<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk:3.1-buster <span class="token keyword">AS</span> build</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /src</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;ServiceB/ServiceB.csproj&quot;</span>, <span class="token string">&quot;ServiceB/&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;ServiceB/ServiceB.csproj&quot;</span></span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/ServiceB&quot;</span></span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;ServiceB.csproj&quot;</span> -c Release -o /app/build</span>

<span class="token instruction"><span class="token keyword">FROM</span> build <span class="token keyword">AS</span> publish</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;ServiceB.csproj&quot;</span> -c Release -o /app/publish</span>

<span class="token instruction"><span class="token keyword">FROM</span> base <span class="token keyword">AS</span> final</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">publish</span></span> /app/publish .</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;dotnet&quot;</span>, <span class="token string">&quot;ServiceB.dll&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ÁÑ∂ÂêéÂÆö‰ΩçÂà∞È°πÁõÆÊ†πÁõÆÂΩïÔºå‰ΩøÁî®ÂëΩ‰ª§ÂéªÁºñËØë‰∏§‰∏™ÈïúÂÉèÔºåservice_aÂíåservice_b</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> service_a:dev <span class="token parameter variable">-f</span> ./ServiceA/Dockerfile <span class="token builtin class-name">.</span>

<span class="token function">docker</span> build <span class="token parameter variable">-t</span> service_b:dev <span class="token parameter variable">-f</span> ./ServiceB/Dockerfile <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/assets/img/consul-04.e9d5ad0c.png" alt=" "></p> <p>ÁúãÂà∞ Successfully Â∞±ÊàêÂäü‰∫ÜÔºåÈÄöËøá<code>docker image ls</code>ÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÊâìÂåÖÁöÑ‰∏§‰∏™ÈïúÂÉè„ÄÇ</p> <p><img src="/assets/img/consul-05.2975ecd5.png" alt=" "></p> <p>ËøôÈáåÈ°∫‰æøÊèê‰∏ÄÂè•ÔºåÂ∑≤ÁªèÂèØ‰ª•ÁúãÂà∞Êàë‰ª¨ÁºñËØëÁöÑÈïúÂÉèÔºåservice_aÂíåservice_b‰∫ÜÔºå‰ΩÜÊòØËøòÊúâËÆ∏Â§öÂêçÁß∞‰∏∫<code>&lt;none&gt;</code>ÁöÑÈïúÂÉèÔºåËøô‰∫õÈïúÂÉèÂèØ‰ª•‰∏çÁî®ÁÆ°ÂÆÉÔºåËøôÁßçÂè´ÂÅöËôöÊÇ¨ÈïúÂÉèÔºåÊó¢Ê≤°Êúâ‰ªìÂ∫ìÂêçÔºå‰πüÊ≤°ÊúâÊ†áÁ≠æ„ÄÇÊòØÂõ†‰∏∫<code>docker build</code>ÂØºËá¥ÁöÑËøôÁßçÁé∞Ë±°„ÄÇÁî±‰∫éÊñ∞ÊóßÈïúÂÉèÂêåÂêçÔºåÊóßÈïúÂÉèÂêçÁß∞Ë¢´ÂèñÊ∂àÔºå‰ªéËÄåÂá∫Áé∞‰ªìÂ∫ìÂêç„ÄÅÊ†áÁ≠æÂùá‰∏∫ <code>&lt;none&gt;</code> ÁöÑÈïúÂÉè„ÄÇ</p> <p>‰∏ÄËà¨Êù•ËØ¥ÔºåËôöÊÇ¨ÈïúÂÉèÂ∑≤ÁªèÂ§±Âéª‰∫ÜÂ≠òÂú®ÁöÑ‰ª∑ÂÄºÔºåÊòØÂèØ‰ª•ÈöèÊÑèÂà†Èô§ÁöÑÔºåÂèØ‰ª•<code>docker image prune</code>ÂëΩ‰ª§Âà†Èô§ÔºåËøôÊ†∑ÈïúÂÉèÂàóË°®Â∞±Âπ≤ÂáÄÂ§ö‰∫Ü„ÄÇ</p> <p>ÊúÄÂêéÂ∞Ü‰∏§‰∏™ÈïúÂÉèservice_aÂíåservice_bÔºåÂàÜÂà´ËøêË°å‰∏â‰∏™ÂÆû‰æã„ÄÇ</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5050:80 <span class="token operator">--</span>name service_a1 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5050&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5051:80 <span class="token operator">--</span>name service_a2 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5051&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5052:80 <span class="token operator">--</span>name service_a3 service_a:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5052&quot;</span>

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5060:80 <span class="token operator">--</span>name service_b1 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5060&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5061:80 <span class="token operator">--</span>name service_b2 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5061&quot;</span>
docker run <span class="token operator">-</span>d <span class="token operator">-</span>p 5062:80 <span class="token operator">--</span>name service_b3 service_b:dev <span class="token operator">--</span>Consul:Port=<span class="token string">&quot;5062&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/consul-06.a7e59de6.png" alt=" "></p> <p>ËøêË°åÊàêÂäüÔºåÊé•‰∏ãÊù•Â∞±ÊòØËßÅËØÅÂ•áËøπÁöÑÊó∂ÂàªÔºåÂéªÂà∞<code>Consul</code>ÁúãÁúã„ÄÇ</p> <p><img src="/assets/img/consul-07.fadc8a5b.png" alt=" "> <img src="/assets/img/consul-08.3da98b2d.png" alt=" "> <img src="/assets/img/consul-09.12728f27.png" alt=" "></p> <p>ÊàêÂäüÂ∞Ü‰∏§‰∏™ÊúçÂä°Ê≥®ÂÜåÂà∞<code>Consul</code>ÔºåÂπ∂‰∏îÊØè‰∏™ÊúçÂä°ÈÉΩÊúâÂ§ö‰∏™ÂÆû‰æã„ÄÇ</p> <p>ËÆøÈóÆ‰∏Ä‰∏ãÊé•Âè£ËØïËØïÂêßÔºåÁúãÁúãËÉΩ‰∏çËÉΩÊàêÂäüÂá∫Áé∞ÁªìÊûú„ÄÇ</p> <p><img src="/assets/img/consul-10.5702fb8f.png" alt=" "></p> <p>Âõ†‰∏∫ÁªàÁ´ØÁºñÁ†ÅÈóÆÈ¢òÔºåÂØºËá¥ÊòæÁ§∫‰π±Á†ÅÔºåËøô‰∏™‰∏çÂΩ±ÂìçÔºåokÔºåËá≥Ê≠§ÊúçÂä°Ê≥®ÂÜåÂ§ßÂäüÂëäÊàê„ÄÇ</p> <h3 id="ÊúçÂä°ÂèëÁé∞"><a href="#ÊúçÂä°ÂèëÁé∞" class="header-anchor">#</a> ÊúçÂä°ÂèëÁé∞</h3> <p>ÊêûÂÆö‰∫ÜÊúçÂä°Ê≥®ÂÜåÔºåÊé•‰∏ãÊù•ÊºîÁ§∫‰∏Ä‰∏ãÂ¶Ç‰ΩïÊúçÂä°ÂèëÁé∞ÔºåÂú®ClientÈ°πÁõÆ‰∏≠ÂÖàÂ∞Ü<code>Consul</code>Âú∞ÂùÄÈÖçÁΩÆÂà∞<code>appsettings.json</code>‰∏≠„ÄÇ</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Consul&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://host.docker.internal:8500&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ÁÑ∂ÂêéÊ∑ªÂä†‰∏Ä‰∏™Êé•Âè£Ôºå<code>IService.cs</code>ÔºåÊ∑ªÂä†‰∏â‰∏™ÊñπÊ≥ïÔºåÂàÜÂà´Ëé∑Âèñ‰∏§‰∏™ÊúçÂä°ÁöÑËøîÂõûÁªìÊûú‰ª•ÂèäÂàùÂßãÂåñÊúçÂä°ÁöÑÊñπÊ≥ï„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IService</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Ëé∑Âèñ ServiceA ËøîÂõûÊï∞ÊçÆ</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Ëé∑Âèñ ServiceB ËøîÂõûÊï∞ÊçÆ</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// ÂàùÂßãÂåñÊúçÂä°</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ÂÆûÁé∞Á±ªÔºö<code>Service.cs</code></p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Concurrent</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Consul</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IService</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IConfiguration</span> _configuration<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ConsulClient</span> _consulClient<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _serviceAUrls<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _serviceBUrls<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">IHttpClientFactory</span> _httpClient<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">Service</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">,</span> <span class="token class-name">IHttpClientFactory</span> httpClient<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>

            _consulClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsulClient</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                options<span class="token punctuation">.</span>Address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>_configuration<span class="token punctuation">[</span><span class="token string">&quot;Consul:Address&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _httpClient <span class="token operator">=</span> httpClient<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_serviceAUrls <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceAÊ≠£Âú®ÂàùÂßãÂåñ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> httpClient <span class="token operator">=</span> _httpClient<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> serviceUrl <span class="token operator">=</span> _serviceAUrls<span class="token punctuation">.</span><span class="token function">ElementAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>_serviceAUrls<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceAÔºö&quot;</span> <span class="token operator">+</span> serviceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">serviceUrl</span><span class="token punctuation">}</span></span><span class="token string">/api/servicea&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_serviceBUrls <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceBÊ≠£Âú®ÂàùÂßãÂåñ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> httpClient <span class="token operator">=</span> _httpClient<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> serviceUrl <span class="token operator">=</span> _serviceBUrls<span class="token punctuation">.</span><span class="token function">ElementAt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>_serviceBUrls<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceBÔºö&quot;</span> <span class="token operator">+</span> serviceUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetStringAsync</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">serviceUrl</span><span class="token punctuation">}</span></span><span class="token string">/api/serviceb&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> serviceNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ServiceB&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> serviceNames<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> queryOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">QueryOptions</span>
                    <span class="token punctuation">{</span>
                        WaitTime <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">await</span> <span class="token function">InitServicesAsync</span><span class="token punctuation">(</span>queryOptions<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">InitServicesAsync</span><span class="token punctuation">(</span><span class="token class-name">QueryOptions</span> queryOptions<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> serviceName<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> _consulClient<span class="token punctuation">.</span>Health<span class="token punctuation">.</span><span class="token function">Service</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> queryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>queryOptions<span class="token punctuation">.</span>WaitIndex <span class="token operator">!=</span> result<span class="token punctuation">.</span>LastIndex<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    queryOptions<span class="token punctuation">.</span>WaitIndex <span class="token operator">=</span> result<span class="token punctuation">.</span>LastIndex<span class="token punctuation">;</span>

                    <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> result<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Address</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Port</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceName <span class="token operator">==</span> <span class="token string">&quot;ServiceA&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        _serviceAUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceName <span class="token operator">==</span> <span class="token string">&quot;ServiceB&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        _serviceBUrls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentBag<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><p>‰ª£Á†ÅÂ∞±‰∏çËß£Èáä‰∫ÜÔºåÁõ∏‰ø°ÈÉΩÂèØ‰ª•ÁúãÊáÇÔºå‰ΩøÁî®‰∫Ü<code>Random</code>Á±ªÈöèÊú∫Ëé∑Âèñ‰∏Ä‰∏™ÊúçÂä°ÔºåÂÖ≥‰∫éËøôÁÇπÂèØ‰ª•ÈÄâÊã©Êõ¥ÂêàÈÄÇÁöÑË¥üËΩΩÂùáË°°ÊñπÂºè„ÄÇ</p> <p>Âú®<code>Startup.cs</code>‰∏≠Ê∑ªÂä†Êé•Âè£‰æùËµñÊ≥®ÂÖ•„ÄÅ‰ΩøÁî®ÂàùÂßãÂåñÊúçÂä°Á≠â‰ª£Á†Å„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">Startup</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            services<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IService<span class="token punctuation">,</span> Service<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">IService</span> service<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                endpoints<span class="token punctuation">.</span><span class="token function">MapControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            service<span class="token punctuation">.</span><span class="token function">InitServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>‰∏ÄÂàáÂ∞±Áª™ÔºåÊ∑ªÂä†apiËÆøÈóÆÊàë‰ª¨ÁöÑ‰∏§‰∏™ÊúçÂä°„ÄÇ</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Client<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;service_result&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">GetService</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromServices</span></span><span class="token punctuation">]</span> <span class="token class-name">IService</span> service<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span>
            <span class="token punctuation">{</span>
                serviceA <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">GetServiceA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                serviceB <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">GetServiceB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Áõ¥Êé•Âú®Visual Studio‰∏≠ËøêË°åClientÈ°πÁõÆÔºåÂú®ÊµèËßàÂô®ËÆøÈóÆapi„ÄÇ</p> <p><img src="/assets/img/consul-11.a1fa2219.png" alt=" "></p> <p>Â§ßÂäüÂëäÊàêÔºåÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞ÔºåÁé∞Âú®Â∞±ÁÆó‰πã‰∏≠ÁöÑÊüê‰∏™ËäÇÁÇπÊåÇÊéâÔºåÊúçÂä°‰πüÂèØ‰ª•ÁÖßÂ∏∏ËøêË°å„ÄÇ</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/meowv/docs/edit/master//stack/dotnetcore/consul.md" target="_blank" rel="noopener noreferrer">Âú® GitHub ‰∏äÁºñËæëÊ≠§È°µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">‰∏äÊ¨°Êõ¥Êñ∞:</span> <span class="time">2 years ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/stack/dotnetcore/exceptionless-in-dotnet.html" class="prev">
        .NET Core ‰∏ã‰ΩøÁî® Exceptionless ËÆ∞ÂΩïÊó•Âøó
      </a></span> <span class="next"><a href="/stack/dotnetcore/api-gateway.html">
        .NET Core ‰∏ãÁöÑ API ÁΩëÂÖ≥
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><!----></div></div>
    <script src="/assets/js/app.b9fe754d.js" defer></script><script src="/assets/js/2.3b8abe35.js" defer></script><script src="/assets/js/6.ce942637.js" defer></script>
  </body>
</html>
